<?php // Before trying to crack the plugin, please consider buying a pro license at http://www.mapsmarker.com. I have put hundreds of hours into the development of the plugin and without honest customers I will not be able to continue the development and support. Thanks for your understanding and your honesty! Robert
if (basename($_SERVER["\123CRIPT_FILE\116\101ME"]) == "leaflet-core.php") { exit ("P\154\145\141se do not \141\143\143ess this\040\146ile direc\164\154y. Thanks!\074\142r/><a href=\047\150ttp://www.\155\141\160smarke\162\056com/go'>w\167\167\056mapsm\141\162\153er.com\074\057a>"); } global $wp_version; if (version_compare($wp_version,"\063\0560","\074")) { exit ("[Leaflet Ma\160\163 Marker Plugin\040\055 installati\157\156\040fail\145\144\041]: Wor\144\120\162ess Ve\162\163\151on 3.0 \157\162 higher is\040\156eeded for \164\150is plugin (\171\157\165 are u\163\151ng version ".$wp_version."\051\040- please upg\162\141\144e your Wor\144\120\162ess inst\141\154lation!"); } if (version_compare(phpversion(),"\065\0562","\074")) { exit ("\133\114eaflet Maps M\141\162\153er Plugi\156\040\055 insta\154\154ation faile\144\135\072 PHP 5\056\062 is neede\144\040for this p\154\165gin (you ar\145\040using PHP ".phpversion()."; note: support f\157\162\040PHP 4 h\141\163\040been of\146\151\143ially \144\151scontinued \163\151\156ce 200\067\05512-31!) - \160\154ease upgrad\145\040your PHP i\156\163\164allati\157\156\041"); } include_once (ABSPATH."wp-admin".DIRECTORY_SEPARATOR."\151ncludes".DIRECTORY_SEPARATOR."plugi\156\056\160hp"); if (is_plugin_active("leaflet-ma\160\163\055marker/lea\146\154\145t-maps-\155\141\162ker.php")) { if (!is_multisite()) { deactivate_plugins("leaflet-maps-ma\162\153\145r/leafle\164\055maps-marker.\160\150\160",$silent=FALSE,$network_wide=NULL); activate_plugin("\154\145\141flet-maps-\155\141\162ker-pro/l\145\141\146let-maps\055\155arker.php",$redirect="\160\154ugins.php?ac\164\151\166ate=true",$network_wide=FALSE,$silent=FALSE); } else { include_once (ABSPATH."\167p-includes".DIRECTORY_SEPARATOR."\160luggable.php"); if (is_network_admin()) { deactivate_plugins("lea\146\154\145t-maps-marke\162\057leaflet-maps-\155\141\162ker.php",$silent=FALSE,$network_wide=TRUE); activate_plugin("\154\145aflet-maps-marke\162\055pro/leaflet-m\141\160\163-marker.\160\150\160",$redirect=FALSE,$network_wide=TRUE,$silent=FALSE); } else { deactivate_plugins("leaflet-maps-\155\141\162ker/leafl\145\164\055maps-ma\162\153\145r.php",$silent=FALSE,$network_wide=NULL); activate_plugin("\154\145aflet-maps-m\141\162\153er-pro/le\141\146\154et-maps-\155\141rker.php",$redirect="plugins.php?ac\164\151\166ate=true",$network_wide=FALSE,$silent=FALSE); } } } if (!defined( "l0"))define( "l0" ,"\1640067146831k"); if (!defined( "LEAFLET_WP_ADMIN_URL"))define( "LEAFLET_WP_ADMIN_URL" ,get_admin_url()); if (!defined( "LEAFLET_PLUGIN_URL"))define( "LEAFLET_PLUGIN_URL" ,plugin_dir_url( __FILE__)); if (!defined( "LEAFLET_PLUGIN_DIR"))define( "LEAFLET_PLUGIN_DIR" ,plugin_dir_path( __FILE__)); $O0=wp_upload_dir(); if (!defined( "LEAFLET_PLUGIN_ICONS_URL"))define( "LEAFLET_PLUGIN_ICONS_URL" ,$O0["baseurl"]."\057leaflet\055\155\141ps-marker\055\151\143ons"); if (!defined( "LEAFLET_PLUGIN_ICONS_DIR"))define( "LEAFLET_PLUGIN_ICONS_DIR" ,$O0["basedir"].DIRECTORY_SEPARATOR."\154\145aflet-maps-mar\153\145\162-icons"); if (!defined( "LEAFLET_PLUGIN_QR_URL"))define( "LEAFLET_PLUGIN_QR_URL" ,$O0["baseurl"]."\057leaflet-maps\055\155\141rker-qr-\143\157\144es"); if (!defined( "LEAFLET_PLUGIN_QR_DIR"))define( "LEAFLET_PLUGIN_QR_DIR" ,$O0["basedir"].DIRECTORY_SEPARATOR."\154eaflet-maps-marker\055\161r-codes"); if (!defined( "l1"))define( "l1" ,get_admin_url()); if (!defined( "O1"))define( "O1" ,plugin_dir_url( __FILE__)); if (!defined( "l2"))define( "l2" ,plugin_dir_path( __FILE__)); $O0=wp_upload_dir(); if (!defined( "O2"))define( "O2" ,$O0["base\165\162\154"]."/leaflet-map\163\055marker-icons"); if (!defined( "l3"))define( "l3" ,$O0["\142asedir"].DIRECTORY_SEPARATOR."\154eaflet-maps-\155\141\162ker-icons"); if (is_admin()) { require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143lass-plugin-u\160\144\141te-checker\056\160hp"); } function O3() { if ((substr($_SERVER["REMOTE_ADDR"],0,4) == "\061\0627.") || ($_SERVER["REMOTE_ADDR"] == "::1")) { return TRUE; } else { return FALSE; } } class l4 { function __construct() { global $wp_version; $O4=get_option("\154eafletmapsmar\153\145\162_options"); add_action("init",array( &$this,"lmm_load_transla\164\151\157n_files"),1); add_action("admi\156\137\151nit",array( &$this,"\154mm_load_sett\151\156\147s_class"),2); add_action("\141dmin_init",array( &$this,"\154\155m_install_and_\165\160\144ates"),3); add_action("\167p_enqueue_scri\160\164\163",array( &$this,"\154\155m_frontend_e\156\161\165eue_script\163")); add_action("wp_print_styles",array( &$this,"lm\155\137\146rontend_enqu\145\165\145_styles\150\145\145ts"),4); add_action("admin_menu",array( &$this,"\154mm_admin_menu"),5); add_action("admi\156\137\151nit",array( &$this,"\154\155m_plugin_meta_l\151\156\153s"),6); if (version_compare($wp_version,"3.3","\074")) { add_action("\167p_head",array( &$this,"\154\155m_image_cs\163\137\157verride"),01750); } add_action("ad\155\151\156_bar_menu",array( &$this,"lmm_add_admin_bar\137\155\145nu"),0225); if (!empty($O4)) { add_shortcode($O4["shortcode"],array( &$this,"lmm_\163\150\157wmap")); } add_filter("wid\147\145\164_text","do_shor\164\143\157de"); if ( isset ($O4["\155\151sc_global_adm\151\156\137notices"]) && ($O4["misc_global_a\144\155\151n_notices"] == "\163\150ow")) { add_action("ad\155\151\156_notices",array( &$this,"\154mm_compatibili\164\171\137checks")); } if (!empty($O4)) { if ($O4["misc_add\137\147\145orss_to_hea\144"] == "\145\156abled") { add_action("\167\160_head",array( &$this,"\154\155\155_add_georss_\164\157\137head")); } } if ( isset ($O4["\155\151sc_tinymce_butt\157\156"]) && ($O4["\155\151\163c_tinymce_bu\164\164\157n"] == "enabled")) { require_once (plugin_dir_path( __FILE__)."\151nc".DIRECTORY_SEPARATOR."\164inymce-plugin.php"); } if ( isset ($O4["misc_plugin\137\154\141nguage"]) && ($O4["misc_\160\154\165gin_language"] != "automa\164\151\143")) { add_filter("\160lugin_locale",array( &$this,"lmm_set_pl\165\147\151n_locale"),"\154\155m"); } add_action("widgets_\151\156\151t",create_function("","return re\147\151\163ter_widget(\042\103lass_leafle\164\137\162ecent_\155\141\162ker_wid\147\145\164\042)\073")); if ( isset ($O4["misc_admin_d\141\163\150board_wid\147\145\164"]) && ($O4["\155isc_admin_dashbo\141\162\144_widget"] == "ena\142\154\145d")) { if (!is_multisite()) { add_action("wp_\144\141\163hboard_setu\160",array( &$this,"\154\155m_register_wi\144\147\145ts")); } else { add_action("wp_n\145\164\167ork_dashb\157\141\162d_setup",array( &$this,"lmm_register_wid\147\145\164s")); add_action("wp_dashboard\137\163\145tup",array( &$this,"\154mm_register_widg\145\164\163")); } } if (( isset ($O4["misc_pointers"])) && ($O4["\155\151\163c_pointers"] == "enabled")) { $version_before_update=get_option("\154\145afletmapsmarker_v\145\162\163ion_pro_b\145\146\157re_upda\164\145"); if ($version_before_update != "0") { add_action("\141dmin_enqueue_s\143\162\151pts",array($this,"lmm_update_p\157\151\156ter_admin_s\143\162\151pts"),01751); } } add_action("admin_enq\165\145ue_scripts",array($this,"lmm_feature_po\151\156ter_admin_scr\151\160\164s"),01752); if (is_multisite()) { add_action("\144\145lete_blog",array( &$this,"\154\155\155_delete_multi\163\151te_blog")); } if (( isset ($O4["\155isc_conditional_\143\163\163_loading"])) && ($O4["\155\151sc_conditional_c\163\163\137loading"] == "\145\156abled")) { add_action("\164\145mplate_include",array( &$this,"lmm_template_\143\150\145ck_shortc\157\144\145")); } add_action("plu\147\151\156_row_meta",array( &$this,"\154mm_plugins_p\141\147\145_add_links"),012,2); add_filter("\165\160load_mimes",array( &$this,"\154mm_permit_mime\137\164\171pes_on_upl\157\141\144")); add_filter("post_mime_types",array( &$this,"\154mm_modify_post_\155\151\155e_types")); } function lmm_modify_post_mime_types($post_mime_types) { $post_mime_types["text/gpx"]=array(__("GPX track","lmm"),__("\115anage GPX tra\143\153\163","lmm"),_n_noop("\107PX track <span cl\141\163\163=\042\143\157unt\042>(%\163\051</span>","\107\120X tracks <span cl\141\163\163=\042c\157\165\156t\042>\050\045s)</span\076","lmm")); return $post_mime_types; } function lmm_permit_mime_types_on_upload($existing_mimes=array()) { $existing_mimes["\147px"]="text/gpx"; return $existing_mimes; } function lmm_plugins_page_add_links($links,$file) { $plugin="leaflet-maps-\155\141\162ker-pro/\154\145\141flet-ma\160\163\055marke\162\056php"; $l5=get_option("\154\145\141fletmapsma\162\153\145r_version\137\160\162o"); if ($file == $plugin) { $O5="<a style=\042\164\145xt-decora\164\151\157n:none;\042\040title=\042".esc_attr__("MapsMa\162\153\145r affiliate \160\162\157gram - s\151\147\156 up now\040\141nd receive \143\157\155missio\156\163\040up to \065\060%!","lmm")."\042 \150\162\145f=\042h\164\164\160s://www.\155\141\160smarker.\143\157m/affiliate\163\042 target=\042\137\142lank\042\076\074img src\075\042".O1."inc/img/\151\143\157n-affiliat\145\163\056png\042\040\167idth=\042\061\066\042 \150\145ight=\042\061\066\042 al\164\075\042affi\154\151ates\042\076\074/a>"; $l6="\074\141 style=\042\164\145xt-decoration\072\156one;\042 h\162\145f=\042ht\164\160\072//www.\155\141\160smarke\162\056com/review\163\042 target=\042\137\142lank\042\040\164itle=\042".esc_attr__("\160lease rate this\040\160\154ugin on \167\157\162dpress.o\162\147","\154mm")."\042><img src=\042".O1."inc/img/icon-star.\160\156\147\042 w\151\144\164h=\042\061\066\042 he\151\147\150t=\042\061\066\042 al\164\075\042rating\163\042></a>"; $O6="<a href=\042\150\164tp://transla\164\145\056mapsmar\153\145\162.com/pr\157\152\145cts/lmm\042\040target=\042\137\142lank\042\040\164itle=\042".esc_attr__("translation\163","\154mm")."\042><img src=\042".O1."\151nc/img/icon-tran\163\154\141tions.png\042\040width=\042\061\066\042 he\151\147\150t=\042\061\066\042 a\154\164\075\042t\162\141nslations\042\076</a>"; $l7="<a href=\042\150\164tp://faceboo\153\056\143om/maps\155\141\162ker\042\040\164arget=\042\137\142lank\042\040\164itle=\042".esc_attr__("\106\157llow MapsMark\145\162\040on Facebo\157\153","\154\155\155")."\042><img sr\143\075\042".O1."inc\057\151\155g/icon-fac\145\142\157ok.png\042\040\167idth=\042\061\066\042 \150\145\151ght=\042\061\066\042 \141\154\164=\042\146\141cebook\042\076\074/a>"; $O7="<a \150\162\145f=\042h\164\164\160://twitte\162\056com/mapsmark\145\162\042 targ\145\164\075\042\137\142\154ank\042\040\164itle=\042".esc_attr__("Follow @MapsMarke\162\040\157n Twitter","lmm")."\042><img src=\042".O1."\151nc/img/icon-twitt\145\162\056png\042\040\167idth=\042\061\066\042 h\145\151ght=\0421\066\042 alt=\042\164\167itter\042\076\074/a>"; $l8="<a href=\042\150\164tp://www.maps\155\141\162ker.com/\053\042 target=\042\137\142lank\042\040\164itle=\042".esc_attr__("\106\157\154low MapsMark\145\162\040on Googl\145\053","\154\155m")."\042><img src=\042".O1."\151nc/img/icon-goo\147\154\145-plus.png\042\040width=\042\061\066\042 he\151\147\150t=\042\061\066\042 al\164\075\042googl\145\053\042><\057\141>"; $O8="\074a href=\042\150\164\164p://feed\163\056\146eedburne\162\056com/MapsMa\162\153\145r\042\040\164arget=\042\137\142lank\042 \164\151tle=\042\122\123\123\042>\074\151mg src=\042".O1."\151\156c/img/icon-rss.p\156\147\042 width\075\04216\042 he\151\147ht=\04216\042\040alt=\042\162\163s\042></a\076"; $l9="\074a href=\042\150\164tp://feedbur\156\145\162.google.c\157\155\057fb/a/\155\141\151lverify\077\165ri=MapsMar\153\145\162\042 \164\141rget=\042\137\142\154ank\042\040\164itle=\042\122\123S (via E\155\141il)\042><\151\155\147 src=\042".O1."\151\156c/img/icon-rs\163\055email.png\042\040\167idth=\042\061\066\042 h\145\151\147ht=\042\061\066\042 a\154\164\075\042\162\163s-email\042\076\074/a>"; if ((O9($la=FALSE,$Oa=TRUE) === TRUE) && (O9() === FALSE)) { $lb="\074br/></td></\164\162\076<tr><td\040\143olspan=\042\063\042><div styl\145\075\042padd\151\156\147: 3px 5\160\170;background\055\143olor: #FFE\102\105\070;bord\145\162\072 1px s\157\154id #CC0000\073\142order-radi\165\163\072 3px;\143\157\154or: #3\063\063;\042\076\074strong>".__("Warning: your acce\163\163\040to upda\164\145\163 and supp\157\162t for Leafl\145\164\040Maps M\141\162ker Pro has\040\145xpired!","lmm")."</strong><br/\076"; $Ob=get_option("leafletmap\163\155\141rker_versi\157\156\137pro_lates\164"); if (($Ob != NULL) && ($Ob>$l5)) { $lb.=__("Latest availa\142\154e version:","\154mm")."\040<a href='h\164\164\160://www.map\163\155\141rker.com\057\166".$Ob."\160' target='_bla\156\153\047 title=\047".esc_attr__("click \164\157\040show relea\163\145\040notes","lmm")."\047>".$Ob."</a> "."(<a href='www.map\163\155\141rker.com/c\150\141\156gelog/pr\157\057' target=\047\137blank'>".__("show all avai\154\141\142le change\154\157\147s","\154mm")."</a>)<br/>"; } $lb.=sprintf(__("\131\157\165 can continu\145\040using version\040\045s without a\156\171 limitation\163\056 Neverthel\145\163\163 you wi\154\154 not be a\142\154\145 to ge\164\040updat\145\163\040inclu\144\151\156g bugf\151\170\145s, new\040\146eatures a\156\144\040optim\151\172ations as\040\167ell as ac\143\145ss to our \163\165pport sys\164\145m. ","\154\155\155"),$l5)."<br/>".sprintf(__("\074a href=\042%\163\042>Please renew \171\157\165r acces\163\040to updates\040\141nd support\040\164o keep your\040\160lugin up-t\157\055date and sa\146\145</a>.","\154\155m"),l1."admin.php?pag\145\075leafletmapsmark\145\162\137license")."</div>"; } else { $lb=""; } $links[]=$O5."\046nbsp;".$l6."&nbsp;".$O6."\046nbsp;".$l7."&nbsp;".$O7."\046nbsp;".$l8."\046nbsp;".$O8."\046\156bsp;".$l9.$lb; } return $links; } function lmm_delete_multisite_blog($blog_id) { switch_to_blog($blog_id); $GLOBALS["\167pdb"]->query("DROP \124\101\102LE `".$GLOBALS["wpdb"]->prefix."leaflet\155\141\160smarker_lay\145\162\163`"); $GLOBALS["wpdb"]->query("DROP TABLE \140".$GLOBALS["wpdb"]->prefix."leafletmapsm\141\162\153er_marker\163\140"); $O0=wp_upload_dir(); $icons_directory=$O0["basedir"].DIRECTORY_SEPARATOR."leafl\145\164\055maps-mark\145\162\055icons".DIRECTORY_SEPARATOR; if (is_dir($icons_directory)) { foreach (glob($icons_directory."*.*") as $v) { unlink($v); } rmdir($icons_directory); } } function lmm_update_pointer_admin_scripts() { $dismissed_pointers=explode(",",(string) get_user_meta(get_current_user_id(),"dismi\163\163\145d_wp_point\145\162\163",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $lc=FALSE; $lmm_version_new=get_option("\154\145afletmapsmark\145\162\137version_\160\162\157"); $Oc="\154mmvp".str_replace(".","",$lmm_version_new); if (! isset ($dismissed_pointers[$Oc])) { $lc=TRUE; add_action("\141dmin_pr\151\156\164_footer_s\143\162ipts",array($this,"lmm_upd\141\164\145_pointer_f\157\157ter_script")); } if ($lc) { wp_enqueue_script("wp-pointer"); wp_enqueue_style("wp-pointer"); } } function lmm_update_pointer_footer_script() { $lmm_version_new=get_option("\154eafletmaps\155\141\162ker_versi\157\156\137pro"); $Oc="lmmvp".str_replace(".","",$lmm_version_new); $ld="\074h3>".sprintf(esc_attr__("Leaflet Maps Mar\153\145\162 plugin u\160\144\141te to v%\061\163 was succ\145\163sful","\154\155m"),$lmm_version_new)."</h3>"; $changelog_url="\074a href=\042".l1."\141\144\155in.php?pa\147\145\075leaflet\155\141\160smarker_\155\141\162kers"."\042\040style=\042\164\145xt-decoration\072\156one;\042>".__("changelog","lmm")."</a>"; $blogpost_url="\074\141 href=\042\150\164tp://www.maps\155\141\162ker.com/\166".$lmm_version_new."\160\042 targ\145\164\075\042_\142\154\141nk\042\040\163tyle=\042\164\145xt-decora\164\151\157n:none\073\042>mapsmarke\162\056com</a>"; $ld.="\074p>".sprintf(esc_attr__("\120\154ease see the %1\163\040for new featu\162\145\163 or the \142\154og post on \045\062s for mor\145\040details","\154mm"),$changelog_url,$blogpost_url)."</p\076"; ?><?php echo "\015\012\011\011\074script type=\042\164ext/javascri\160\164\042>// <\041\133CDATA[\015\012\011\011jQu\145\162\171(docum\145\156t).ready(fu\156\143tion(\044\051\040\173\015\012\011\011\011\151\146(typeof\050\152Query().p\157\151\156ter) !\075\040'undefi\156\145d') \173\015\012\011\011\011\011\044\050\047#topleve\154\137page_leaf\154\145tmapsmar\153\145r_marker\163\047).point\145\162(\173\015\012\011\011\011\011\011co\156\164ent: '"; ?><?php echo $ld; ?><?php echo "\047,\015\012\011\011\011\011\011position: \173\015\012\011\011\011\011\011\011\145dge: 'le\146\164',\015\012\011\011\011\011\011\011align:\040\047center'\015\012\011\011\011\011\011},\015\012\011\011\011\011\011close\072\040function\050\051 \173\015\012\011\011\011\011\011\011\044\056post(\040\141jaxurl, \173\015\012\011\011\011\011\011\011\011poin\164\145r: '"; ?><?php echo $Oc; ?><?php echo "',\015\012\011\011\011\011\011\011\011\141ction: 'dis\155\151ss-wp-point\145\162\047\015\012\011\011\011\011\011\011});\015\012\011\011\011\011\011}\015\012\011\011\011\011\175).point\145\162('open');\015\012\011\011\011\175\015\012\011\011});\015\012\011\011//\040\135]></scri\160\164>\015\012\011\011"; ?><?php } function lmm_feature_pointer_admin_scripts() { $dismissed_pointers=explode("\054",(string) get_user_meta(get_current_user_id(),"dismissed_wp_poi\156\164\145rs",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $lc=FALSE; if (! isset ($dismissed_pointers["lmmesw"])) { $lc=TRUE; add_action("\141dmin_print_foo\164\145\162_scripts",array($this,"lmm_featu\162\145\137pointer_fo\157\164\145r_script")); } if ($lc) { wp_enqueue_script("\167\160-pointer"); wp_enqueue_style("\167p-pointer"); } } function lmm_feature_pointer_footer_script() { include ("\151nc".DIRECTORY_SEPARATOR."\146eature-point\145\162\163.php"); } function lmm_register_widgets() { $O4=get_option("leafletmapsmarke\162\137\157ptions"); if ($O4["misc_whitelab\145\154\137backend"] == "\145\156\141bled") { $Od=__("\115\141ps - recent m\141\162\153ers","lmm"); } else { $Od=__("Maps Marker Pro -\040\162ecent marker\163","lmm"); } wp_add_dashboard_widget("\154mm-admin-das\150\142\157ard-widget",$Od,array( &$this,"l\155\155\137dashboard_w\151\144\147et"),array( &$this,"\154mm_dashboard_widg\145\164\137control")); } function lmm_dashboard_widget() { global $wpdb; $O4=get_option("leafletmapsm\141\162ker_options"); if ($O4["\144efaults_marke\162\137\143ustom_ico\156\137\165rl_dir"] == "\156\157") { $defaults_marker_icon_dir=l3; $defaults_marker_icon_url=O2; } else { $defaults_marker_icon_dir=htmlspecialchars($O4["\144efaults_ma\162\153\145r_icon_dir"]); $defaults_marker_icon_url=htmlspecialchars($O4["\144efaults_marker_ic\157\156\137url"]); } $table_name_markers=$wpdb->prefix."\154\145afletmapsma\162\153\145r_markers"; $widgets=get_option("dash\142\157\141rd_widget_op\164\151\157ns"); $widget_id="\154\155\155-admin-das\150\142\157ard-widget"; $number_of_markers= isset ($widgets[$widget_id]) && isset ($widgets[$widget_id]["\151\164\145ms"]) ? absint($widgets[$widget_id]["\151\164ems"]): 4; if ((O9($la=FALSE,$Oa=TRUE) === TRUE) && (O9() === FALSE)) { $l5=get_option("leafl\145\164\155apsmarker_\166\145\162sion_pro"); echo "\074div style\075\042padding: 3px \065\160x;background-\143\157\154or: #F\106\105\102E8;borde\162\072 1px solid\040\043CC0000;bo\162\144\145r-radi\165\163\072 3px;\143\157\154or: #3\063\063;\042><\163\164rong>".__("Warnin\147\072 your access to\040\165pdates and su\160\160\157rt for \114\145\141flet Ma\160\163\040Marker\040\120ro has ex\160\151red!","lmm")."</strong><br/>"; $Ob=get_option("lea\146\154\145tmapsmarker_\166\145\162sion_pro\137\154\141test"); if (($Ob != NULL) && ($Ob>$l5)) { echo __("Latest availa\142\154\145 version:","\154mm")." <a href='http:/\057\167ww.mapsmarker\056\143om/v".$Ob."\160' target='_bla\156\153\047 title='".esc_attr__("click to sho\167\040release notes","\154\155m")."'>".$Ob."\074/a> "."(<a href='www\056\155\141psmarker.\143\157\155/change\154\157\147/pro/'\040\164arget='_bla\156\153'>".__("show all avai\154\141\142le change\154\157\147s","\154mm")."\074/a>)<br/>"; } echo sprintf(__("\131\157u can continue\040\165\163ing vers\151\157\156 %s wit\150\157\165t any l\151\155itations. N\145\166\145rtheles\163\040you will n\157\164\040be ab\154\145\040to ge\164\040updates in\143\154\165ding b\165\147\146ixes, \156\145\167 featu\162\145\163 and \157\160timization\163\040as well a\163\040access t\157\040our suppo\162\164 system. ","lmm"),$l5)."\074br/>".sprintf(__("\074\141 href=\042\045\163\042>Plea\163\145\040renew yo\165\162\040access\040\164o updates a\156\144\040suppo\162\164\040to kee\160\040your plug\151\156\040up-to-\144\141\164e and \163\141\146e</a>.","\154\155m"),l1."admin.php?page=l\145\141\146letmapsma\162\153\145r_license")."</div>"; echo "\074\150r style=\042\142\157\162der:0;he\151\147\150t:1px;ba\143\153ground-co\154\157\162:#d8d8\144\070;\042/>"; } $le=$wpdb->get_results($wpdb->prepare( "\123\105\114ECT ID,ma\162\153\145rname,ico\156\054\143reatedo\156\054createdby \106\122\117M $table_name_markers ORDER BY create\144\157\156 desc LIM\111\124\040%d" ,$number_of_markers),ARRAY_A); if ($le != NULL) { echo "<tab\154\145\040style=\042\155\141rgin-botto\155\0725px;\042>\074\164r>"; foreach ($le as $row) { $icon=($row["i\143\157\156"] == NULL) ? O1."leafl\145\164\055dist/image\163\057marker.png": $defaults_marker_icon_url."/".$row["\151\143on"]; echo "<td><a href=\042".l1."admin.php?page=le\141\146\154etmapsma\162\153\145r_marker\046\151d=".$row["\111\104"]."\042 title=\042".esc_attr__("\145dit marker","lmm")."\042><img \163\162\143=\042".$icon."\042\040\163tyle=\042\167\151\144th:80%;\042\076</a>"; echo "<td s\164\171\154e=\042ve\162\164\151cal-alig\156\072\164op;line\055\150eight:1.2e\155\073\042>"; echo "\074\141 href=\042".l1."adm\151\156\056php?page=l\145\141\146letmapsma\162\153\145r_marke\162\046id=".$row["ID"]."\042 title=\042".esc_attr__("\145dit marker","lmm")."\042>".htmlspecialchars(stripslashes($row["m\141\162\153ername"]))."\074/a><br/>".__("\143reated on","lmm")." ".date("Y-m-d - \150\072\155",strtotime($row["createdon"]))."\054\040".__("cre\141\164\145d by","lmm")."\040".$row["creat\145\144\142y"]; echo "</td></tr>"; } echo "\074/table>"; } else { echo "<p style=\042\155\141rgin-bott\157\155\0725px;\042\076".__("No \155\141\162ker created\040\171et","lmm")."</p>"; } if (! isset ($widgets[$widget_id]["blogposts"])) { $Oe=1; } else if ( isset ($widgets[$widget_id]["\142logposts"]) && ($widgets[$widget_id]["\142logposts"] == 1)) { $Oe=0; } else { $Oe=1; } if (($Oe == 1) && ($O4["\155isc_whitelabe\154\137\142ackend"] == "\144\151\163abled")) { require_once (ABSPATH.WPINC.DIRECTORY_SEPARATOR."class-simplepie\056\160hp"); $lf=new simplepie(); if (file_exists($defaults_marker_icon_dir.DIRECTORY_SEPARATOR."\162\145adme-icons.tx\164")) { $lf->enable_cache(TRUE); $lf->set_cache_location($location=$defaults_marker_icon_dir); $lf->set_cache_duration(0250600); } else { $lf->enable_cache(FALSE); } $lf->set_feed_url("\150\164tp://feeds.fe\145\144\142urner.c\157\155\057MapsMar\153\145r"); $lf->set_stupidly_fast(TRUE); $lf->enable_order_by_date(TRUE); $lf->init(); $lf->handle_content_type(); echo "<hr style=\042\142\157rder:0;hei\147\150\164:1px;bac\153\147\162ound-co\154\157\162:#d8d8d\070\073\042/><\163\164\162ong><p>".__("L\141\164\145st blog pos\164\163\040from www\056\155\141psmarke\162\056com","lmm")."</p></strong>"; if ($lf->get_items() == NULL) { $blogpost_url="\074a href=\042ht\164\160\072//www.ma\160\163\155arker.c\157\155\057news\042\040target=\042\137\142lank\042\076\150ttp://www.m\141\160smarker.co\155\057news</a>"; echo sprintf(__("Fee\144\040\143ould not b\145\040\162etrieved\054\040please try \141\147\141in late\162\040or read th\145\040latest blog\040\160osts at %\163","\154mm"),$blogpost_url); } foreach ($lf->get_items(0,3) as $item) { echo "\074\160  style=\042\155\141rgin:0.5em 0\073\042>".$item->get_date("\152\040F Y").": <strong><a hr\145\146\075\042".$item->get_permalink()."\077\162\145f=dashboar\144\042\076".$item->get_title()."\074/a></strong></p\076".PHP_EOL; } echo "<\160\076<a style=\042\164\145xt-decorati\157\156\072none;\042\040href=\042\150\164tp://www.ma\160\163\155arker.c\157\155\042 targ\145\164=\042_bl\141\156\153\042>\074\151mg src=\042".O1."inc/img/icon-websi\164\145\055home.png\042\040width=\042\061\066\042 he\151\147\150t=\042\061\066\042 al\164\075\042mapsm\141\162ker.com\042\076\040MapsMar\153\145r.com</a>&\156\142\163p;<a s\164\171le=\042te\170\164-decoratio\156\072none;\042\040\164itle=\042".esc_attr__("MapsMa\162\153\145r affiliate \160\162\157gram - s\151\147\156 up now\040\141nd receive c\157\155missions u\160\040\164o 50%!","\154\155m")."\042\040\150ref=\042h\164\164\160s://www.ma\160\163\155arker.co\155\057affiliates\042\040target=\042\137\142lank\042\076\074img src=\042".O1."inc\057\151\155g/icon-affi\154\151\141tes.png\042\040\167idth=\042\0616\042 hei\147\150\164=\042\061\066\042 alt\075\042affiliates\042\076 ".__("Affiliates","l\155\155")."\074/a>&nbsp;<a \163\164\171le=\042\164\145xt-decorati\157\156\072none;\042\040href=\042\150\164tp://www.m\141\160\163marker.\143\157m/reviews\042\040target=\042\137\142lank\042\040\164itle=\042".esc_attr__("\160lease rate this p\154\165\147in on word\160\162\145ss.org","lmm")."\042\076\074\151mg src=\042".O1."inc\057\151\155g/icon-star.\160\156\147\042 \167\151\144th=\042\061\066\042 h\145\151\147ht=\042\061\066\042 al\164\075\042rati\156\147s\042> ".__("rate plugin","lmm")."</a>&nbsp\073\074a href=\042\150\164\164p://tran\163\154\141te.map\163\155\141rker.co\155\057projects/l\155\155\042 targe\164\075\042_bl\141\156\153\042>\074\151mg src=\042".O1."\151\156c/img/icon-tran\163\154\141tions.png\042\040width=\042\061\066\042 \150\145\151ght=\042\061\066\042 \141\154\164=\042t\162\141nslation\163\042> ".__("translatio\156\163","lmm")."\074/a>&nbsp;<a \150\162\145f=\042h\164\164\160://twit\164\145\162.com/m\141\160\163marker\042\040target=\042\137\142lank\042\076\074img src=\042".O1."inc\057\151\155g/icon-twit\164\145\162.png\042\040\167idth=\042\061\066\042 he\151\147\150t=\042\061\066\042 alt\075\042twitter\042\076 Twitter</a\076\046nbsp;<a h\162\145f=\042htt\160\072//facebook\056\143om/mapsmar\153\145r\042 ta\162\147\145t=\042\137\142lank\042\076\074img src\075\042".O1."\151\156c/img/icon-fa\143\145\142ook.png\042\040\167idth=\042\061\066\042 \150\145\151ght=\042\061\066\042 \141\154\164=\042\146\141cebook\042\076\040Faceboo\153\074/a>&nbsp;<\141\040href=\042\150\164tp://www.m\141\160smarker.co\155\057+\042 ta\162\147\145t=\042\137\142lank\042\076\074img sr\143\075\042".O1."inc/\151\155\147/icon-googl\145\055plus.png\042\040\167idth=\042\061\066\042 h\145\151\147ht=\042\061\066\042 a\154\164\075\042\147\157ogle+\042\076\040Google+<\057\141>&nbsp;<a \163\164\171le=\042\164\145xt-decora\164\151\157n:non\145\073\042 href\075\042http://w\167\167.mapsmark\145\162.com/chan\147\145log\042 \164\141rget=\042\137\142lank\042\076\074img sr\143\075\042".O1."inc/img/icon\055\143\150angelog-h\145\141\144er.png\042\040\167idth=\042\061\066\042\040\150\145ight=\042\0616\042 alt\075\042changelog\042\076 ".__("\103hangelog","lmm")."\074/a>&nbsp;<a hr\145\146\075\042h\164\164\160://feeds\056\146eedburner.\143\157\155/MapsMa\162\153\145r\042\040\164arget=\042\137\142lank\042\076\074img src\075\042".O1."\151\156c/img/icon-\162\163\163.png\042\040\167idth=\042\061\066\042 he\151\147ht=\04216\042\040alt=\042\162\163\163\042> \122\123S</a>&nbsp\073\074a href=\042\150\164tp://fee\144\142\165rner.g\157\157\147le.com\057\146b/a/mailve\162\151fy?uri=Map\163\115\141rker\042\040target=\042\137\142lank\042\076\074img sr\143\075\042".O1."inc\057\151\155g/icon-rss-e\155\141\151l.png\042\040\167idth=\042\061\066\042 \150\145ight=\042\061\066\042 alt=\042\162ss-email\042\076\040".__("E\055\115\141il","lmm")."</a></p>"; } } function lmm_dashboard_widget_control() { $widget_id="lmm-ad\155\151\156-dashboard-\167\151dget"; $form_id="\154mm-admin-das\150\142\157ard-widget\055\143ontrol"; $update=FALSE; if (!$widget_options=get_option("dashboa\162\144\137widget_opti\157\156\163")) $widget_options=array(); if (! isset ($widget_options[$widget_id])) { $widget_options[$widget_id]=array("\142logposts" => 0,"\151\164ems" => 5); $update=TRUE; } if ("\120\117ST" == $_SERVER["REQUEST_METHOD"] && isset ($_POST[$form_id])) { $number=($_POST[$form_id]["items"] == NULL) ? "\063": absint($_POST[$form_id]["\151tems"]); $Of= isset ($_POST[$form_id]["blogposts"]) ? "1": "\060"; $widget_options[$widget_id]["items"]=$number; $widget_options[$widget_id]["blogp\157\163ts"]=$Of; $update=TRUE; } if ($update) update_option("dashboard_wid\147\145t_options",$widget_options); $number= isset ($widget_options[$widget_id]["items"]) ? (int) $widget_options[$widget_id]["\151tems"]: ""; echo "<p><label for=\042\154mm-admin-das\150\142\157ard-wid\147\145\164-numbe\162\042>".__("\116umber of marke\162\163\040to show:")."\040</label>"; echo "\074input id=\042\154\155\155-admin-da\163\150\142oard-wid\147\145\164-numbe\162\042 name=\042".$form_id."[item\163\135\042 type=\042\164\145xt\042\040\166alue=\042".$number."\042 siz\145\075\0422\042\040\057></p>"; if ($O4["misc_whitelabel_\142\141\143kend"] == "disab\154\145\144") { echo "\074p><label fo\162\075\042lmm-admi\156\055dashboard-wi\144\147\145t-blog\160\157\163ts\042\076".__("\110\151de blog posts an\144\040link section:")."\040</label>"; echo "<input id=\042\154\155m-admin-dashb\157\141\162d-widget\055\142logposts\042\040\156ame=\042".$form_id."[bl\157\147\160osts]\042\040\164ype=\042c\150\145\143kbo\170\042 ".checked($widget_options[$widget_id]["blogposts"],1,FALSE)."/></p>"; } } function lmm_load_translation_files() { load_plugin_textdomain("lmm",FALSE,dirname(plugin_basename( __FILE__))."\057languages/"); } function lmm_set_plugin_locale($lang) { $O4=get_option("\154\145afletmapsmarker\137\157\160tions"); global $locale; if ($O4["misc_plugin_l\141\156\147uage_area"] == "\142\141\143kend") { return is_admin() ? $O4["\155isc_plugin_langua\147\145"]: $locale; } else if ($O4["\155isc_plugin_langua\147\145\137area"] == "fron\164\145\156d") { return is_admin() ? $locale: $O4["\155isc_plugin_languag\145"]; } else if ($O4["misc_plugin\137\154\141nguage_ar\145\141"] == "both") { return $O4["\155\151sc_plugin_lan\147\165\141ge"]; } else { return $locale; } } function lmm_compatibility_checks() { include ("\151\156\143".DIRECTORY_SEPARATOR."compat\151\142\151lity-check\163\056php"); } function lmm_help() { include ("\154eaflet-help-credi\164\163\056php"); } function lmm_settings() { global $lg; $lg->display_page(); } function lmm_list_layers() { include ("leafle\164\055list-layers.ph\160"); } function lmm_list_markers() { include ("\154\145\141flet-list-m\141\162\153ers.php"); } function lmm_layer() { include ("leaflet-layer.php"); } function lmm_marker() { include ("\154\145\141flet-marker\056\160hp"); } function lmm_import_export() { include ("\154eaflet-impor\164\055\145xport.ph\160"); } function lmm_tools() { include ("\154\145aflet-tools\056\160\150p"); } function lmm_add_georss_to_head() { $georss_to_head="<link \162\145\154=\042a\154\164\145rnate\042\040\164ype=\042\141\160plication/\162\163s+xml\042\040\164itle=\042".get_bloginfo("name")." GeoRSS-Feed\042\040\150ref=\042".O1."leaf\154\145\164-georss.php?l\141\171\145r=all\042\040\057>".PHP_EOL; echo $georss_to_head; } function lmm_showmap($atts) { require ("inc".DIRECTORY_SEPARATOR."\163howmap_prepa\162\145\056php"); return $Og; } function lmm_load_settings_class() { if (is_admin()) { require_once (plugin_dir_path( __FILE__)."\151nc".DIRECTORY_SEPARATOR."\143\154ass-leaflet-opt\151\157\156s.php"); global $lg; $lg=new class_leaflet_options(); } } function lmm_admin_menu() { global $wp_version; if (version_compare($wp_version,"3.8-alpha","\076")) { $lh="\055\167hite"; } else { $lh=""; } $O4=get_option("leaf\154\145\164mapsmarker_\157\160\164ions"); if (!empty($O4)) { $capabilities=$O4["\143apabilities_\145\144\151t"]; } else { $capabilities="\145\144it_posts"; $Oh="\141\143\164ivate_plugin\163"; } if ($O4["misc_whitelabel_b\141\143\153end"] == "enabled") { $Oi=esc_attr__("Maps","lmm"); $Oh="\141\143\164ivate_plugin\163"; } else { $Oi="<span style=\042\146\157nt-size:92\045\073\042>Map\163\040Marker Pro\074\057span>"; $Oh=$O4["\143apabilities_\145\144\151t"]; } $page=add_object_page($Oi,$Oi,$capabilities,"leafletmapsm\141\162\153er_marker\163",array( &$this,"lmm_li\163\164\137markers"),O1."\151\156\143/img/icon-m\145\156\165-page".$lh."\056png"); if (!empty($O4)) { $page2=add_submenu_page("leaf\154\145\164mapsmarker\137\155\141rkers",$Oi." -\040".__("List all marke\162\163","lmm"),"\074\151mg src=\042".O1."inc/img/icon-men\165\055\154ist".$lh."\056\160\156g\042>\040".__("\114\151st all markers","\154\155m"),$O4["\143apabilities_ed\151\164"],"\154eafletmapsmark\145\162\137markers",array( &$this,"lmm_\154\151\163t_markers")); $page3=add_submenu_page("leafletmapsm\141\162\153er_marker\163",$Oi." - ".__("\141dd/edit marker","lm\155"),"<img src=\042".O1."\151nc/img/ico\156\055menu-add".$lh.".png\042\076\040".__("Add\040\156\145w marker","\154\155\155"),$O4["capabilities_edi\164"],"\154eafletmapsmarker\137\155\141rker",array( &$this,"\154\155m_marker")); $page3b=add_submenu_page("leafl\145\164\155apsmarker_m\141\162\153ers",$Oi." - ".__("\111mport/Export","\154mm"),"\074\151mg src=\042".O1."inc/img/icon-men\165\055\151mport-ex\160\157\162t".$lh."\056\160ng\042> ".__("Import/Export","l\155\155"),$O4["\143apabilities_edit"],"leafl\145\164\155apsmarker_im\160\157\162t_export",array( &$this,"\154mm_import_export")); $page4=add_submenu_page("leafletmapsmar\153\145\162_markers",$Oi."\040- ".__("\114\151st all layer\163","\154mm"),"<img src=\042".O1."\151nc/img/icon-me\156\165\055list".$lh."\056\160ng\042> ".__("List all layers","lmm"),$O4["capabiliti\145\163\137edit"],"leafletm\141\160\163marker_layer\163",array( &$this,"lmm_l\151\163\164_layers")); $page5=add_submenu_page("leafletm\141\160\163marker_mark\145\162\163",$Oi." - ".__("a\144\144\057edit layer","\154mm"),"<img src=\042".O1."\151nc/img/icon-me\156\165\055add".$lh."\056\160ng\042> ".__("Add new layer","lmm"),$O4["\143apabilities_e\144\151\164"],"leafletmapsmar\153\145\162_layer",array( &$this,"lmm_layer")); } else { $page=""; $page2=""; $page3=""; $page3b=""; $page4=""; $page5=""; } $page6=add_submenu_page("\154eafletmapsmarker\137\155\141rkers",$Oi." - ".__("Too\154\163","lmm"),"<hr noshade size=\042\061\042/><img\040\163rc=\042".O1."inc\057\151\155g/icon-men\165\055tools".$lh.".\160\156\147\042> ".__("Tools","\154mm"),$Oh,"leafletm\141\160\163marker_too\154\163",array( &$this,"lmm_tool\163")); $page7=add_submenu_page("\154\145afletmapsmarker\137\155\141rkers",$Oi." - ".__("\123\145ttings","lmm"),"<img src=\042".O1."\151nc/img/icon-men\165\055\163ettings".$lh."\056\160ng\042> ".__("\123ettings","lmm"),$Oh,"leafletm\141\160\163marker_sett\151\156\147s",array( &$this,"lmm_setting\163")); if (!empty($O4)) { $page8=add_submenu_page("\154eafletmapsmar\153\145\162_markers",$Oi." - ".__("\123\165\160port","lmm"),"<im\147\040\163rc=\042".O1."inc/img/icon-m\145\156\165-help".$lh."\056\160ng\042> ".__("Support","lmm"),$Oh,"\154eafletmapsmark\145\162\137help",array( &$this,"lmm_help")); $page10=add_submenu_page("leafletmapsmarke\162\137\155arkers",$Oi." - ".__("License\040\163\145ttings","\154\155\155"),"\074\150r noshade size=\042\061\042/><im\147\040src=\042".O1."inc/i\155\147\057icon-menu-s\145\164\164ings".$lh."\056\160ng\042> ".__("License settings","lmm"),$Oh,"leaflet\155\141\160smarker_lic\145\156\163e","\155aps_marker_pro_\154\151\143ense_activ\141\164\151on_page"); } else { $page8=""; $page10=""; } add_action("admi\156\137\160rint_scripts\055".$page3,array( &$this,"\154\155\155_admin_enq\165\145\165e_scripts"),7); add_action("admi\156\137\160rint_scripts\055".$page5,array( &$this,"lmm_admin_enqu\145\165\145_scripts"),8); add_action("\141dmin_print_scrip\164\163\055".$page7,array( &$this,"\154\155m_admin_jquery_u\151"),011); add_action("admin_pr\151\156\164_styles-".$page,array( &$this,"\154\155m_admin_enqueue\137\163\164ylesheets"),021); add_action("\141\144min_print_st\171\154\145s-".$page2,array( &$this,"\154mm_admin_enqueue_\163\164\171lesheets"),022); add_action("admin_pr\151\156\164_styles-".$page3,array( &$this,"lmm_admin_enqueue\137\163\164ylesheets"),023); add_action("admin_prin\164\137\163tyles-".$page3b,array( &$this,"\154\155\155_admin_enque\165\145\137styleshee\164\163"),023); add_action("\141\144min_print_style\163\055".$page4,array( &$this,"lmm_adm\151\156\137enqueue_sty\154\145\163heets"),024); add_action("admi\156\137\160rint_styles\055".$page5,array( &$this,"lmm_admin\137\145\156queue_style\163\150\145ets"),025); add_action("admin_print\137\163\164yles-".$page6,array( &$this,"l\155\155\137admin_enqueue\137\163\164ylesheets"),026); add_action("admin_prin\164\137\163tyles-".$page7,array( &$this,"\154mm_admin_enq\165\145\165e_styleshe\145\164\163"),027); add_action("admin_print_styl\145\163\055".$page8,array( &$this,"\154\155\155_admin_enqu\145\165\145_styleshe\145\164\163"),027); add_action("\141dmin_print_st\171\154\145s-".$page10,array( &$this,"\154\155m_admin_enque\165\145\137stylesheet\163"),027); add_action("\141\144\155in_print_styl\145\163\055".$page3,array( &$this,"\154mm_admin_enqueu\145\137\163tylesheets\137\144\141tepicker"),030); add_action("\141\144min_enqueue_scri\160\164\163",array( &$this,"\154mm_admin_enq\165\145\165e_styleshee\164\163\137adminbar"),031); add_action("a\144\155\151n_print_scr\151\160\164s-".$page,array( &$this,"\154mm_add_contextua\154\137\150elp")); add_action("admin_print_scri\160\164\163-".$page2,array( &$this,"\154\155m_add_contextual\137\150\145lp")); add_action("admin_print_scri\160\164\163-".$page3,array( &$this,"\154\155\155_add_contex\164\165\141l_help")); add_action("\141\144min_print_script\163\055".$page3b,array( &$this,"\154\155\155_add_context\165\141\154_help")); add_action("\141\144min_print_scrip\164\163\055".$page4,array( &$this,"\154\155\155_add_contex\164\165\141l_help")); add_action("admin_print_scr\151\160\164s-".$page5,array( &$this,"lm\155\137\141dd_contextua\154\137\150elp")); add_action("admin_print_scrip\164\163\055".$page6,array( &$this,"\154\155\155_add_context\165\141\154_help")); add_action("admi\156\137\160rint_script\163\055".$page7,array( &$this,"lmm_add_contextu\141\154\137help")); add_action("admin_print_\163\143\162ipts-".$page8,array( &$this,"lmm_add_\143\157\156textual_help")); add_action("admin_print_sc\162\151\160ts-".$page10,array( &$this,"\154\155\155_add_context\165\141\154_help")); add_action("ad\155\151\156_print_scrip\164\163\055".$page3,array( &$this,"\154\155\155_admin_enqu\145\165\145_scripts_j\161\165\145rydatep\151\143\153er")); add_action("a\144\155\151n_head-".$page3,array( &$this,"\154\155\155_image_css_o\166\145\162ride"),01750); add_action("admin_head\055".$page5,array( &$this,"\154mm_image_css_ove\162\162\151de"),01750); } function lmm_add_admin_bar_menu() { global $wp_version; if (version_compare($wp_version,"3.1",">=")) { $O4=get_option("leafletmapsmarke\162\137\157ptions"); if ($O4["admin_bar_integr\141\164\151on"] == "enabled" && current_user_can($O4["\143apabilities_\145\144\151t"])) { global $wp_admin_bar; if ($O4["misc_whi\164\145\154abel_backe\156\144"] == "\145nabled") { $lj=esc_attr__("\115\141ps","lmm"); $Oj=""; } else { $lj="Maps Mar\153\145\162 Pro"; $Oj=array("\164itle" => "\127\157rdpress-Plugin ".__("\142\171","\154mm")." www.mapsmarker.\143\157\155"); } if (version_compare($wp_version,"3\056\070-alpha","\076")) { $lh="-white"; $lk="<span\040\143\154ass=\042\141\142-icon\042\076\074/span><sp\141\156 class=\042\141\142-label\042\076".$lj."</span>"; } else { $lk="<img style=\042\146loat:left;marg\151\156\0723px 5px \060\0400;\042 \163\162\143=\042".O1."inc/img/icon-t\151\156\171mce.png\042\057\076 ".$lj; $lh=""; } $menu_items=array(array("\151\144" => "lmm","title" => $lk,"href" => "","meta" => $Oj),array("\151\144" => "\154mm-markers","\160\141rent" => "lmm","title" => "\074img src=\042".O1."inc/img/icon-me\156\165\055list".$lh."\056\160ng\042> ".__("List all markers","lmm"),"\150\162\145f" => l1."\141\144min.php?page=\154\145\141fletmaps\155\141\162ker_mark\145\162s"),array("\151\144" => "\154mm-add-marke\162","parent" => "lmm","title" => "\074\151mg src=\042".O1."inc/img/icon-menu\055\141\144d".$lh.".png\042\076\040".__("Ad\144\040\156ew marker","\154\155m"),"href" => l1."admin.php?page=lea\146\154\145tmapsma\162\153\145r_marke\162"),array("id" => "\154mm-import-export","parent" => "lmm","title" => "\074\151mg src=\042".O1."\151nc/img/icon-menu\055\151\155port-exp\157\162\164".$lh."\056\160ng\042> ".__("\111mport/Export","lm\155"),"\150\162ef" => l1."admin.php?page=l\145\141\146letmapsmar\153\145\162_import_\145\170port"),array("\151\144" => "lmm-layers","\160\141rent" => "lmm","title" => "\074\151mg src=\042".O1."inc/img/icon-men\165\055list".$lh.".png\042\076\040".__("L\151\163\164 all layers","\154\155m"),"href" => l1."admin.php?page\075\154eafletmapsmar\153\145\162_layers"),array("id" => "lmm\055\141\144d-layers","\160\141rent" => "lmm","title" => "<img src=\042".O1."\151nc/img/icon-m\145\156\165-add".$lh.".p\156\147\042> ".__("\101\144d new layer","lmm"),"href" => l1."admin.php?page\075\154eafletmapsmark\145\162\137layer")); if (current_user_can("activate_plugin\163") && ($O4["misc_whi\164\145\154abel_backen\144"] == "\144\151sabled")) { $menu_items=array_merge($menu_items,array(array("\151\144" => "lmm-tools","\160arent" => "lmm","title" => "\074hr style=\042\155\141\162gin:3px 0\073\042 noshade si\172\145\075\042\061\042/><img sr\143\075\042".O1."inc/img/\151\143\157n-menu-too\154\163".$lh.".png\042\076\040".__("\124\157ols","lmm"),"href" => l1."admin.php?page=l\145\141\146letmapsma\162\153\145r_tools"),array("\151\144" => "\154mm-settings","\160arent" => "\154mm","title" => "\074img src=\042".O1."\151nc/img/icon-men\165\055settings".$lh."\056\160ng\042> ".__("\123\145ttings","lmm"),"href" => l1."admi\156\056\160hp?page=le\141\146\154etmapsmar\153\145\162_settin\147\163"))); } if ($O4["misc_whitelabe\154\137backend"] == "disabled") { $menu_items=array_merge($menu_items,array(array("id" => "lmm-help-credits","\160arent" => "lmm","title" => "\074img src=\042".O1."\151nc/img/icon-\155\145\156u-help".$lh."\056\160ng\042> ".__("\123upport","lmm"),"\150ref" => l1."a\144\155\151n.php?page=le\141\146\154etmapsmar\153\145\162_help"),array("\151\144" => "\154mm-license","parent" => "lmm","title" => "<hr style=\042\155\141rgin:3px 0;\042\040\156oshade s\151\172\145=\042\061\042/><img s\162\143\075\042".O1."\151nc/img/icon-me\156\165\055settings".$lh."\056png\042> ".__("\114icense setti\156\147\163","l\155\155"),"\150ref" => l1."admin.p\150\160\077page=leafl\145\164mapsmarker_lic\145\156\163e"))); } foreach ($menu_items as $menu_item) { $wp_admin_bar->add_menu($menu_item); } } } } function lmm_add_contextual_help() { global $wp_version; $helptext="<p>".__("Do you hav\145\040questions or i\163\163\165es with L\145\141\146let Map\163\040Marker? Pl\145\141\163e use \164\150\145 follow\151\156g support \143\150\141nnels \141\160\160ropria\164\145\154y.","\154\155\155")."<br/>"; $helptext.="<st\162\157ng>".__("B\145\146\157re you pos\164\040a new suppo\162\164\040ticket\054\040please \146\157llow the in\163\164ructions f\162\157\155 <a hr\145\146=\042htt\160\072//www.map\163\155arker.com/r\145\141\144me-fir\163\164\042 targ\145\164=\042_bl\141\156\153\042>\150\164tp://www\056\155apsmarke\162\056com/read\155\145-first</a\076\040which g\151\166e you a g\165\151deline on\040\150ow to de\141\154 with t\150\145 most com\155\157n issue\163\056","lmm")."</strong></p>"; $helptext.="<ul>"; $helptext.="<li><a href\075\042http://www.m\141\160smarker.com/\146\141\161/\042\040\164arget=\042\137\142lank\042\076".__("FA\121","\154\155m")."\074/a> (".__("\146requently asked \161\165\145stions","\154mm")."\051</li>"; $helptext.="\074\154i><a href=\042\150\164tp://www.map\163\155\141rker.com/\144\157cs/\042 \164\141\162get=\042\137\142lank\042\076".__("Documen\164\141\164ion","\154\155\155")."\074/a></li>"; $helptext.="\074li><a href=\042\150\164tp://www.maps\155\141\162ker.com/l\157\147in\042 ta\162\147\145t=\042\137\142lank\042>\155\141psmarker.c\157\155/login</a>\040\050".__("support for p\162\157\040users","\154\155m")."\051</li>"; $helptext.="\074\057ul>"; if (version_compare($wp_version,"\063.3","<")) { global $current_screen; add_contextual_help($current_screen,$helptext); } else if (version_compare($wp_version,"\063.3","\076=")) { $screen=get_current_screen(); $screen->add_help_tab(array("\151d" => "lmm\137\150\145lp_tab","title" => __("Help &\040\123\165pport","\154\155m"),"\143\157\156tent" => $helptext)); } } function lmm_admin_jquery_ui() { $l5=get_option("\154eafletmapsmark\145\162\137version"); wp_enqueue_script(array("jquery")); wp_enqueue_script("\154eafletmapsmarker\055\142ootstrap-tabs",LEAFLET_PLUGIN_URL."inc/js/bootstr\141\160\055tabs.mi\156\056js",array("\152\161\165ery"),$l5); wp_enqueue_script("leaf\154\145\164mapsmarker-s\145\154\145ct2",LEAFLET_PLUGIN_URL."\151\156\143/js/select2/\163\145\154ect2.min.\152\163",array("\152\161\165ery"),$l5); wp_enqueue_style("leafletmapsmarker\055\163elect2",LEAFLET_PLUGIN_URL."inc/js/select\062\057select2.css",array(),$l5); wp_localize_script("leafletmapsmarke\162\055select2","\155\141\160smarkerjs",array("\163\145ttings_search_\160\154\141ceholder" => __("\163\164\141rt full-text \163\145\141rch","\154\155m"),"settings_search_\156\157\137results" => __("\116\157 matches fou\156\144","lmm"))); } function lmm_frontend_enqueue_scripts() { global $wp_version; $O4=get_option("\154\145afletmapsmarker\137\157\160tions"); $l5=get_option("leafletmaps\155\141\162ker_versio\156\137\160ro"); $google_adsense_status=$O4["go\157\147\154e_adsense_st\141\164\165s"]; if ($google_adsense_status == "enabled") { $gmaps_libraries="\046libraries=adsense"; } else { $gmaps_libraries=""; } if ($O4["g\157\157\147le_maps_la\156\147\165age_local\151\172\141tion"] == "\142\162owser_settin\147") { $google_language=""; } else if ($O4["\147\157ogle_maps_la\156\147\165age_locali\172\141\164ion"] == "\167\157\162dpress_set\164\151\156g") { if (defined( "WPLANG")) { $google_language="&language=".substr(WPLANG,0,2); } else { $google_language="\046language\075\145n"; } } else { $google_language="\046language=".$O4["google_maps_langu\141\147\145_localiza\164\151\157n"]; } if ($O4["\147\157\157gle_maps_bas\145\137\144omain_cus\164\157\155"] == "") { $gmaps_base_domain="\046\142ase_domain=".$O4["google_maps_ba\163\145\137domain"]; } else { $gmaps_base_domain="&base_\144\157\155ain=".$O4["\147oogle_maps_b\141\163\145_domain_cus\164\157\155"]; } if ( isset ($O4["\147oogle_maps_a\160\151\137key"]) && ($O4["googl\145\137\155aps_api_key"] != NULL)) { $google_maps_api_key=$O4["goo\147\154\145_maps_api_key"]; } else { $google_maps_api_key=""; } if ((version_compare($wp_version,"3.3",">=")) && ($O4["\155isc_javascri\160\164\137header_foo\164\145\162"] == "foote\162")) { wp_register_script("\154\145afletmapsmark\145\162\055google\155\141\160s-loader","h\164\164\160s://www.googl\145\056\143om/jsapi\077\153ey=".$google_maps_api_key,array(),.37e1,TRUE); } else if ((version_compare($wp_version,"\063.3","<")) || ((version_compare($wp_version,"\063\0563",">=")) && ($O4["misc_javascrip\164\137\150eader_fo\157\164\145r"] == "he\141\144\145r"))) { wp_enqueue_script("l\145\141\146letmapsmarke\162\055googlemaps-lo\141\144\145r","https://www.googl\145\056\143om/jsapi\077\153ey=".$google_maps_api_key,array(),NULL); } $google_styling_json=($O4["google_styl\151\156\147_json"] == NULL) ? "disabled": str_replace("\042","\047",$O4["google_st\171\154\151ng_json"]); if ($O4["\142\151ngmaps_culture"] == "automatic") { if (defined( "WPLANG")) { $bing_culture=WPLANG; } else { $bing_culture="\145n_us"; } } else { $bing_culture=$O4["\142\151\156gmaps_cultur\145"]; } if ((version_compare($wp_version,"3.3",">\075")) && ($O4["misc_ja\166\141\163cript_header\137\146ooter"] == "footer")) { wp_register_script("leafletma\160\163\155arker",O1."leaflet-dist/lea\146\154\145t.js",array("\154\145\141fletmapsmark\145\162\055googlem\141\160\163-loader"),$l5,TRUE); wp_register_script("s\150\157\167_map",O1."i\156\143\057js/show_ma\160\056js",array("leafle\164\155\141psmarker"),$l5,TRUE); } else if ((version_compare($wp_version,"\063.3","<")) || ((version_compare($wp_version,"3.3","\076=")) && ($O4["misc_javascript_he\141\144\145r_footer"] == "\150\145\141der"))) { wp_enqueue_script("\154\145afletmapsmar\153\145\162",O1."\154eaflet-dist/le\141\146\154et.js",array("l\145\141\146letmapsmarke\162\055\147ooglemap\163\055loader"),$l5); } if ($google_adsense_status == "disable\144") { wp_localize_script("\154eafletmapsma\162\153\145r","\155\141\160smarkerjs",array("\172\157om_in" => __("\132\157\157m in","lmm"),"zoom_out" => __("Zoo\155\040\157ut","lmm"),"googlema\160\163\137language" => $google_language,"\147\157oglemaps_libra\162\151\145s" => $gmaps_libraries,"googlemaps_base_d\157\155\141in" => $gmaps_base_domain,"bin\147\137\143ulture" => $bing_culture,"google_ads\145\156\163e_status" => $google_adsense_status,"\147oogle_styling_jso\156" => $google_styling_json,"\155\151nimap_show" => __("\123\150ow minimap","\154\155\155"),"minimap_hide" => __("Hide minimap","\154\155\155"),"\155inimap_statu\163" => $O4["minimap_status"],"\146\165\154lscreen_but\164\157\156_title" => __("\126iew fullscreen","\154\155m"),"fullscreen_butto\156\137\160osition" => $O4["map_fullscreen_\142\165\164ton_positi\157\156"],"\155\141\170zoom" => intval($O4["\147\154obal_maxzoom_l\145\166\145l"]))); } else { $google_adsense_format=$O4["\147oogle_adsense_for\155\141\164"]; $google_adsense_position=$O4["goo\147\154\145_adsense_pos\151\164\151on"]; $google_adsense_backgroundColor=$O4["\147\157ogle_adsense\137\142\141ckgroundC\157\154\157r"]; $google_adsense_borderColor=$O4["\147\157ogle_adsense_bor\144\145\162Color"]; $google_adsense_titleColor=$O4["\147oogle_adsense_ti\164\154\145Color"]; $google_adsense_textColor=$O4["\147\157\157gle_adsense_t\145\170\164Color"]; $google_adsense_urlColor=$O4["google_ad\163\145\156se_urlColo\162"]; $google_adsense_channelNumber=$O4["google_adse\156\163\145_channelNu\155\142\145r"]; $google_adsense_publisherId=$O4["google_ad\163\145\156se_publishe\162\111\144"]; wp_localize_script("lea\146\154\145tmapsmarker","\155\141psmarkerjs",array("\172\157om_in" => __("Zoom\040\151\156","lmm"),"zoom_out" => __("\132oom out","lmm"),"googlemaps_lan\147\165\141ge" => $google_language,"g\157\157\147lemaps_librar\151\145\163" => $gmaps_libraries,"googl\145\155\141ps_base_domai\156" => $gmaps_base_domain,"bing_culture" => $bing_culture,"google_ad\163\145\156se_status" => $google_adsense_status,"\147oogle_adsense_form\141\164" => $google_adsense_format,"goog\154\145\137adsense_posi\164\151\157n" => $google_adsense_position,"\147\157ogle_adsense\137\142\141ckgroundCo\154\157\162" => $google_adsense_backgroundColor,"google_ads\145\156\163e_borderCo\154\157\162" => $google_adsense_borderColor,"\147\157ogle_adsense_tit\154\145\103olor" => $google_adsense_titleColor,"\147\157ogle_adsens\145\137\164extColor" => $google_adsense_textColor,"\147oogle_adsense_u\162\154\103olor" => $google_adsense_urlColor,"\147oogle_adsense_ch\141\156\156elNumber" => $google_adsense_channelNumber,"\147oogle_adsense_\160\165\142lisherId" => $google_adsense_publisherId,"google_styling_\152\163\157n" => $google_styling_json,"minimap_\163\150\157w" => __("Show minimap","lmm"),"minimap_\150\151\144e" => __("H\151\144\145 minimap","lmm"),"minimap_status" => $O4["\155\151nimap_status"],"\146ullscreen_button_\164\151\164le" => __("V\151\145\167 fullscreen","\154\155m"),"fullscreen_button_\160\157\163ition" => $O4["\155ap_fullscreen_bu\164\164\157n_position"],"maxzoom" => intval($O4["\147\154obal_maxzoom_l\145\166\145l"]))); } } function lmm_admin_enqueue_scripts() { global $wp_version; $O4=get_option("\154\145afletmapsmarker_o\160\164\151ons"); $l5=get_option("l\145\141\146letmapsmarke\162\137\166ersion_pr\157"); $google_adsense_status=$O4["\147\157ogle_adsense_\163\164\141tus"]; if ($google_adsense_status == "\145nabled") { $gmaps_libraries="&libra\162\151\145s=places,a\144\163\145nse"; } else { $gmaps_libraries="&libraries=\160\154\141ces"; } if (defined( "WPLANG")) { $lang=substr(WPLANG,0,2); } else { $lang="\145\156"; } if ($O4["\147oogle_maps_lang\165\141\147e_localiza\164\151\157n"] == "bro\167\163\145r_setting") { $google_language=""; } else if ($O4["google_m\141\160\163_language_\154\157\143alizatio\156"] == "\167ordpress_setti\156\147") { if (defined( "WPLANG")) { $google_language="\046language=".substr(WPLANG,0,2); } else { $google_language="\046language=en"; } } else { $google_language="&language=".$O4["google_maps_lang\165\141\147e_localiz\141\164\151on"]; } if ($O4["\147\157ogle_maps_base\137\144\157main_cust\157\155"] != "") { $gmaps_base_domain="\046base_domain=".$O4["google_maps\137\142\141se_domain"]; } else { $gmaps_base_domain="\046base_domain=".$O4["\147oogle_maps_base_\144\157\155ain_custo\155"]; } wp_enqueue_script(array("jquery")); $page=( isset ($_GET["\160\141\147e"]) ? $_GET["page"]: ""); if ($page == "\154\145afletmapsmarker_\154\141\171er") { if (version_compare($wp_version,"3.5","\076=")) { wp_enqueue_media(); } else { wp_enqueue_style("t\150\151\143kbox"); wp_enqueue_script("\155edia-upload"); wp_enqueue_script("\164hickbox"); wp_enqueue_script("\155\145dia-models"); } } if ( isset ($O4["google_maps_api_key"]) && ($O4["google_m\141\160\163_api_key"] != NULL)) { $google_maps_api_key=$O4["\147oogle_maps_api_\153\145\171"]; } else { $google_maps_api_key=""; } wp_enqueue_script("leaf\154\145\164mapsmarker-\147\157\157glemaps-l\157\141\144er","https:\057\057www.google.com/\152\163\141pi?key=".$google_maps_api_key,array(),NULL); $google_styling_json=($O4["google\137\163\164yling_json"] == NULL) ? "disa\142\154\145d": str_replace("\042","\047",$O4["google_styling_jso\156"]); if ($O4["\142\151\156gmaps_cultur\145"] == "aut\157\155\141tic") { if (defined( "WPLANG")) { $bing_culture=WPLANG; } else { $bing_culture="\145n_us"; } } else { $bing_culture=$O4["bingmaps_c\165\154\164ure"]; } wp_enqueue_script("\154\145\141fletmapsmar\153\145\162",O1."\154eaflet-dist/leafl\145\164\056js",array("leaf\154\145\164mapsmarker-\147\157\157glemaps-l\157\141\144er"),$l5); if ($google_adsense_status == "\144\151sabled") { wp_localize_script("\154\145afletmapsmarke\162","mapsmarkerjs",array("\172\157om_in" => __("Zoom i\156","\154\155\155"),"zoom_out" => __("Zoom out","lmm"),"\147ooglemaps_lan\147\165\141ge" => $google_language,"\147ooglemaps_librari\145\163" => $gmaps_libraries,"googlemaps_bas\145\137\144omain" => $gmaps_base_domain,"\142\151ng_culture" => $bing_culture,"google_adsen\163\145\137status" => $google_adsense_status,"\147\157ogle_styling_js\157\156" => $google_styling_json,"minimap\137\163\150ow" => __("Sh\157\167\040minimap","\154\155\155"),"minimap_hide" => __("\110\151\144e minimap","l\155\155"),"\155\151nimap_status" => $O4["\155\151nimap_status"],"\146\165\154lscreen_butt\157\156\137title" => __("View fullscr\145\145\156","lmm"),"fullscreen_butt\157\156\137position" => $O4["\155ap_fullscree\156\137\142utton_posi\164\151\157n"],"maxzoom" => intval($O4["\147lobal_maxzoo\155\137\154evel"]))); } else { $google_adsense_format=$O4["google_adse\156\163\145_format"]; $google_adsense_position=$O4["google_a\144\163\145nse_position"]; $google_adsense_backgroundColor=$O4["g\157\157\147le_adsense_b\141\143\153groundColo\162"]; $google_adsense_borderColor=$O4["google_ad\163\145\156se_borderCo\154\157\162"]; $google_adsense_titleColor=$O4["google_\141\144\163ense_titleC\157\154\157r"]; $google_adsense_textColor=$O4["google_\141\144\163ense_textCol\157\162"]; $google_adsense_urlColor=$O4["\147\157ogle_adsense_u\162\154\103olor"]; $google_adsense_channelNumber=$O4["\147\157\157gle_adsens\145\137\143hannelNumb\145\162"]; $google_adsense_publisherId=$O4["google\137\141\144sense_publis\150\145\162Id"]; wp_localize_script("\154eafletmapsm\141\162\153er","\155\141psmarkerjs",array("zoom\137\151\156" => __("\132\157\157m in","lmm"),"zoom_out" => __("\132oom out","lmm"),"\147ooglemaps_langua\147\145" => $google_language,"googl\145\155\141ps_librarie\163" => $gmaps_libraries,"\147ooglemaps_ba\163\145\137domain" => $gmaps_base_domain,"\142\151ng_culture" => $bing_culture,"google_a\144\163\145nse_status" => $google_adsense_status,"google_adsense_for\155\141\164" => $google_adsense_format,"\147\157\157gle_adsense_\160\157\163ition" => $google_adsense_position,"\147oogle_adsense_\142\141\143kgroundColo\162" => $google_adsense_backgroundColor,"\147\157\157gle_adsense\137\142\157rderColor" => $google_adsense_borderColor,"google\137\141\144sense_titleC\157\154\157r" => $google_adsense_titleColor,"\147oogle_adsense_tex\164\103\157lor" => $google_adsense_textColor,"\147oogle_adsense_url\103\157\154or" => $google_adsense_urlColor,"\147\157ogle_adsense_cha\156\156\145lNumber" => $google_adsense_channelNumber,"google_adsens\145\137\160ublisherI\144" => $google_adsense_publisherId,"google_styl\151\156\147_json" => $google_styling_json,"mi\156\151\155ap_show" => __("\123\150ow minimap","lm\155"),"\155\151nimap_hide" => __("Hide \155\151\156imap","lmm"),"minimap_status" => $O4["\155\151nimap_status"],"fullscreen_button_t\151\164\154e" => __("Vi\145\167\040fullscreen","\154\155m"),"fullscreen_button_\160\157\163ition" => $O4["\155\141p_fullscree\156\137\142utton_posi\164\151\157n"],"maxzoo\155" => intval($O4["glo\142\141\154_maxzoom_leve\154"]))); } } function lmm_image_css_override() { $O4=get_option("\154eafletmapsma\162\153\145r_options"); echo "\074\163tyle type=\042\164\145xt/css\042\040\151d=\042le\141\146\154etmaps\155\141\162ker-ima\147\145\055css-o\166\145\162ride\042\076.leaflet-p\157\160\165p-conte\156\164 img \173 \155\141x-width:".intval($O4["\144efaults_mark\145\162\137popups_ima\147\145\137max_widt\150"])."p\170\040!important; heigh\164\072auto; margin:\040\060px !import\141\156\164; paddi\156\147\072 0px \041\151mportant; b\157\170-shadow:n\157\156\145 !impo\162\164\141nt; wi\144\164\150:auto \041\151mportant; \175\040.marker-c\154\165\163ter-sm\141\154\154 \173\011\142ackgroun\144\055color: ".$O4["clustering_color_\163\155\141ll"]."\073\040} .marker-clust\145\162\055small di\166\040\173 backg\162\157und-color: ".$O4["\143\154\165stering_col\157\162\137small_inn\145\162"]."\073 color: ".$O4["clustering_color_s\155\141\154l_text"]."\073 } .marker-clust\145\162\055medium \173\040\142ackgroun\144\055color: ".$O4["clustering_c\157\154\157r_medium"]."\073 } .marker-clus\164\145\162-medium di\166\040\173 backgro\165\156d-color: ".$O4["clustering_\143\157\154or_medium_\151\156\156er"]."\073 color: ".$O4["\143lustering_color_\155\145\144ium_text"]."\073 } .marker-cl\165\163\164er-large \173\040\142ackgroun\144\055color: ".$O4["clustering_colo\162\137\154arge"]."\073\040} .marker-clu\163\164\145r-large d\151\166\040\173 b\141\143\153ground\055\143olor: ".$O4["clusteri\156\147\137color_large\137\151\156ner"]."\073 color: ".$O4["\143\154ustering_colo\162\137\154arge_text"]."\073 }</style>"; } function lmm_admin_enqueue_scripts_jquerydatepicker() { $l5=get_option("leafletmapsmark\145\162\137version_\160\162\157"); wp_enqueue_script(array("jqu\145\162\171","jquery-ui\055\164\141bs","jque\162\171\055ui-datepick\145\162","\152\161\165ery-ui-slide\162")); wp_enqueue_script("\152\161\165ery-ui-time\160\151\143ker-addon",O1."\151\156c/js/jquery-ui-ti\155\145\160icker-add\157\156\056js",array("jquery","jquery-ui-tab\163","\152query-ui-datepic\153\145\162"),$l5); } function lmm_frontend_enqueue_stylesheets() { $O4=get_option("\154\145afletmapsmar\153\145\162_options"); if (( isset ($O4["misc_condi\164\151\157nal_css_lo\141\144\151ng"])) && ($O4["misc_c\157\156\144itional_css\137\154\157ading"] == "enab\154\145\144")) { global $wp_query; $posts=$wp_query->posts; $pattern=get_shortcode_regex(); $l5=get_option("\154eafletmapsma\162\153\145r_version\137\160\162o"); global $wp_version; wp_register_style("\154\145afletmapsmarke\162",O1."\154\145\141flet-dist/le\141\146\154et.css",array(),$l5); if (is_array($posts)) { foreach ($posts as $post) { if (preg_match_all("/".$pattern."/s",$post->post_content ,$matches) && array_key_exists(2,$matches) && in_array($O4["\163\150\157rtcode"],$matches[2])) { wp_enqueue_style("leafletmapsm\141\162\153er"); wp_enqueue_style("leafletmapsm\141\162\153er-ie-only"); break; } } if (version_compare($wp_version,"3.\063","\076\075")) { $lmm_custom_css="\056leaflet-popup-c\157\156\164ent img \173\040\155ax-width\072".intval($O4["\144efaul\164\163_marker_popups\137\151mage_max_wi\144\164\150"])."\160\170\040!importa\156\164\073 heigh\164\072auto; margi\156\072 0px !impo\162\164ant; paddin\147\072 0px !imp\157\162\164ant; b\157\170-shadow:no\156\145 !importan\164\073 width:au\164\157\040!impo\162\164ant; } .ma\162\153\145r-clu\163\164\145r-smal\154\040\173 b\141\143kground-co\154\157r: ".$O4["clustering_co\154\157\162_small"]."\073 } .marker-c\154\165\163ter-small \144\151\166 \173 b\141\143kground-col\157\162\072 ".$O4["\143\154\165stering_co\154\157\162_small_inn\145\162"]."\073\040color: ".$O4["cluste\162\151\156g_color_sm\141\154\154_text"]."\073 } .marker-\143\154\165ster-mediu\155\040\173 backgr\157\165\156d-colo\162\072\040".$O4["clustering_c\157\154\157r_medium"]."\073 } .marker-cluste\162\055\155edium di\166\040\173 backg\162\157\165nd-col\157\162\072 ".$O4["clus\164\145\162ing_color_me\144\151\165m_inner"]."\073  color: ".$O4["clustering_color\137\155\145dium_text"]."\073\040} .marker-\143\154\165ster-large\040\173 background-\143\157lor: ".$O4["\143lustering_colo\162\137\154arge"]."\073\040} .marker-clus\164\145\162-large di\166\040\173 backg\162\157\165nd-col\157\162\072 ".$O4["clustering_col\157\162\137large_inne\162"].";  color: ".$O4["clustering_color\137\154\141rge_text"]."\073\040}"; wp_add_inline_style("l\145\141\146letmapsmark\145\162",$lmm_custom_css); } } } else { global $wp_version; $l5=get_option("leafletmapsmark\145\162_version_pro"); wp_register_style("leafletmaps\155\141\162ker",O1."leaflet-dist/\154\145\141flet.css",array(),$l5); wp_enqueue_style("leafletmapsmarker"); if (version_compare($wp_version,"3.3","\076=")) { $lmm_custom_css=".leaflet-p\157\160\165p-content \151\155\147 \173 \155\141\170-width:".intval($O4["\144\145faults_marker_po\160\165\160s_image_m\141\170\137width"])."px !important; he\151\147\150t:auto; ma\162\147\151n: 0px !\151\155portant; pa\144\144ing: 0px !i\155\160ortant; box\055\163hadow:none\040\041importan\164\073 width:aut\157\040!important\073\040} .marke\162\055cluster-sm\141\154\154 \173\040\142ackground\055\143olor: ".$O4["\143\154ustering_color\137\163\155all"]."\073 } .marker-clus\164\145\162-small div\040\173 background\055\143olor: ".$O4["cluste\162\151\156g_color_smal\154\137\151nner"]."\073 color: ".$O4["clustering_colo\162\137\163mall_text"]."\073 } .marker-cl\165\163\164er-medium \173\040background-\143\157lor: ".$O4["\143lustering_co\154\157\162_medium"]."\073 } .marker-cluste\162\055\155edium d\151\166\040\173 \142\141\143kgroun\144\055color: ".$O4["clusteri\156\147\137color_mediu\155\137\151nner"]."; color: ".$O4["\143lustering_color_m\145\144\151um_text"]."\073 } .marker-clust\145\162\055large \173\040\142ackground\055\143olor: ".$O4["clustering_color_l\141\162\147e"]."\073\040\175 .marker-cl\165\163\164er-large \144\151\166 \173 \142\141ckground-co\154\157\162: ".$O4["clustering_color\137\154\141rge_inner"]."\073 color: ".$O4["\143lustering_c\157\154\157r_large_tex\164"]."; }"; wp_add_inline_style("l\145\141\146letmapsmarker",$lmm_custom_css); } } } function lmm_template_check_shortcode($template) { $O4=get_option("l\145\141\146letmapsmark\145\162_options"); $searchterm="\133".$O4["\163\150\157rtcode"]; $files=array($template,get_stylesheet_directory().DIRECTORY_SEPARATOR."\150\145ader.php",get_stylesheet_directory().DIRECTORY_SEPARATOR."footer.php"); foreach ($files as $file) { if (file_exists($file)) { $contents=file_get_contents($file); if (strpos($contents,$searchterm)) { $l5=get_option("leafletmapsmar\153\145\162_version\137\160\162o"); wp_register_style("le\141\146\154etmapsmarker",O1."leaflet-dis\164\057leaflet.css",array(),$l5); wp_enqueue_style("leafl\145\164\155apsmarker"); break; } } } return $template; } function lmm_admin_enqueue_stylesheets() { $l5=get_option("leafletmaps\155\141\162ker_versio\156\137\160ro"); wp_register_style("leafletmapsmarke\162",O1."leaflet-dist/leafl\145\164\056css",array(),$l5); wp_enqueue_style("leafletmapsmarker"); wp_register_style("\154\145\141fletmapsmar\153\145\162-admin",O1."\151nc/css/leafle\164\155\141psmarker-a\144\155\151n.css",array(),$l5); wp_enqueue_style("le\141\146\154etmapsmarker\055\141dmin"); if (is_plugin_active("flickr-ga\154\154\145ry/flickr-\147\141\154lery.php")) { wp_dequeue_style("fg-\152\161\165ery-ui"); } } function lmm_admin_enqueue_stylesheets_datepicker() { $l5=get_option("le\141\146\154etmapsmarker\137\166\145rsion_pr\157"); wp_register_style("\152query-ui-all",O1."\151\156c/css/jquery-\144\141\164epicker-t\150\145\155e/jquery\055\165i-1.9.2.cu\163\164om.css",array(),$l5); wp_enqueue_style("\152query-ui-all"); wp_register_style("jquery-ui-t\151\155\145picker-add\157\156",O1."\151\156c/css/jquer\171\055\144atepicker\055\164heme/jquery-\165\151\055timep\151\143\153er-addo\156\056css",array("\152\161\165ery-ui-all"),NULL); wp_enqueue_style("\152\161uery-ui-timepic\153\145\162-addon"); } function lmm_admin_enqueue_stylesheets_adminbar() { $O4=get_option("\154\145afletmapsmarke\162\137\157ptions"); if ($O4["admi\156\137\142ar_integrat\151\157\156"] == "enabled" && current_user_can($O4["\143apabilities_edi\164"])) { $l5=get_option("\154eafletmapsmarker\137\166\145rsion_pro"); wp_register_style("\154\145\141fletmapsma\162\153\145r-admin-ad\155\151\156bar",O1."i\156\143\057css/leafle\164\155\141psmarker-a\144\155\151n-adminb\141\162.css",array(),$l5); wp_enqueue_style("leafletmapsmarke\162\055\141dmin-ad\155\151\156bar"); } } function lmm_install_and_updates() { $current_version="vp151"; $schedule_transient="\154\145afletmapsmarker\137\151\156stall_upd\141\164\145_cache_".$current_version; $install_update_schedule=get_transient($schedule_transient); if ($install_update_schedule === FALSE) { $schedule_transient="\154\145afletmapsmark\145\162\137install_u\160\144\141te_cache\137".$current_version; set_transient($schedule_transient,"execu\164\145\040install a\156\144 update-routi\156\145\040only o\156\143\145 a day",074*074*030); include ("\151\156\143".DIRECTORY_SEPARATOR."install-and-update\163\056php"); } } function lmm_plugin_meta_links() { define( "FB_BASENAME" ,plugin_basename( __FILE__)); define( "FB_BASEFOLDER" ,plugin_basename(dirname( __FILE__))); define( "FB_FILENAME" ,str_replace(FB_BASEFOLDER."\057","",plugin_basename( __FILE__))); function leafletmapsmarker_filter_plugin_meta($links,$file) { if ($file == FB_BASENAME) { array_unshift($links,"\074a href=\042".l1."adm\151\156\056php?page=l\145\141\146letmapsma\162\153\145r_marke\162\163\042>".__("Markers","lmm")."</a>","<a hr\145\146\075\042".l1."\141dmin.php?page=leaf\154\145\164mapsmarke\162\137\154ayers\042\076".__("\114\141\171ers","lmm")."</a>","<a hre\146\075\042".l1."\141\144\155in.php?page=le\141\146\154etmapsma\162\153\145r_settin\147\163\042>".__("Settings","lmm")."\074/a>","<a href=\042".l1."\141dmin.php?page=lea\146\154\145tmapsmarke\162\137\154icense\042\076".__("Li\143\145\156se","lmm")."\074/a>"); } return $links; } add_filter("\160\154ugin_action_\154\151\156ks","le\141\146\154etmapsmarker\137\146\151lter_plu\147\151\156_meta",012,2); } } if (is_admin()) { $Ok= isset ($_GET["\160\141ge"]) ? $_GET["\160\141ge"]: ""; $ll=array("\154\145\141fletmapsma\162\153\145r_markers","leaflet\155\141\160smarker_mark\145\162","leaf\154\145\164mapsmarker_la\171\145\162s","\154\145afletmapsmark\145\162\137layer","\154\145afletmapsmar\153\145\162_tools","\154\145afletmapsmarker\137\163\145ttings"); if ((in_array($Ok,$ll)) && (O3() === FALSE)) { if (lm() !== TRUE) { exit (header("Location: ".l1."\141\144min.php?page\075\154eafletmapsmar\153\145\162_license")); } if (O9($la=l0,$Oa=FALSE) === FALSE) { $Om=array("\154eafletmapsma\162\153\145r_markers","\154eafletmapsmar\153\145\162_marker","\154eafletmapsmarker_\154\141\171ers","\154\145afletmapsmarker_\154\141\171er","\154\145afletmapsmark\145\162\137tools","\154\145afletmapsmar\153\145\162_settings"); if (in_array($Ok,$Om)) { echo "<script \164\171\160e=\042\164\145\170t/javascr\151\160\164\042>\167\151ndow.locati\157\156\056href \075\040\042".l1."\141\144min.php?page=\154\145\141fletmapsma\162\153\145r_licens\145\046error=le\042\073</script>  "; } } } } function ln($On,$is_theme=FALSE) { $lo=""; if ( isset ($_GET["\160age"])) { $lo=$_GET["p\141\147\145"]; } elseif ( isset ($_POST["page"])) { $lo=$_POST["page"]; } $Oo=in_array($lo,$On); if ($is_theme) { return $Oo; } $lp=in_array(plugin_basename( __FILE__),get_option("\141\143tive_plugins")); return ($Oo && $lp); } function lm($Op=FALSE) { $lq=new Oq; $lq->lr ="database"; $lq->ls =array("\154\157cal_key" => get_option("\154eafletmapsmarker\160\162\157_license\137\154\157cal_key")); $lq->Os =array("fu\156\143\164ion" => "\165\160\144ate_option","key" => "\154eafletmapsmark\145\162\160ro_license\137\154\157cal_key"); $lq->lt ="\061,2,3,4,5,6,7,8,9,1\060"; $lq->Ot =get_option("leaf\154\145\164mapsmarkerp\162\157\137license_k\145\171"); $lq->lu ="\067\143a99e156b5e30e0\066\0648f49b81178cd7\145"; $lq->Ou ="htt\160\163\072//www.mapsm\141\162\153er.com/st\157\162\145/api/in\144\145x.php"; $lq->validate(); if ($Op) { return $lq; } $On=array("\154eafletmapsmar\153\145\162_markers","leafletmapsmarke\162\137\155arker","\154eafletmapsmarker\137\154\141yers","\154\145afletmapsmarker_\154\141\171er","\154\145afletmapsma\162\153\145r_tools","\154eafletmapsmarker_s\145\164\164ings"); if (is_admin() && ln($On,TRUE) && $lq->lv) { return $lq->lv; } return TRUE; } function O9($la=FALSE,$Oa=FALSE) { $lq=new Oq; if ($la !== FALSE) { $lq->la =strrev(substr($la,1,012)); } $lq->lr ="\144atabase"; $lq->ls =array("\154ocal_key" => get_option("\154eafletmapsmarker\160\162\157_license_l\157\143\141l_key")); $lq->Os =array("func\164\151\157n" => "updat\145\137\157ption","\153ey" => "\154eafletmapsmarke\162\160\162o_license_l\157\143\141l_key"); $lq->lt ="\061\0542,3,4,5,6,7,\070\0549,10"; $lq->Ot =get_option("\154eafletmapsmarker\160\162\157_license_k\145\171"); $lq->lu ="\067ca99e156b5e30\145\060\06648f49b8\061\06178cd7e"; $lq->Ou ="\150\164tps://www.mapsma\162\153\145r.com/sto\162\145\057api/ind\145\170.php"; $lq->validate(); if ($Oa !== FALSE) { if ($lq->lv) { return FALSE; } else { return TRUE; } } if ($lq->lv) { return FALSE; } if ($la === FALSE) { $Ov=$lq->lw["\144\157wnload_access_\145\170\160ires"]; $Ow=$lq->lw["support_acc\145\163\163_expires"]; $lx=abs(($Ov>$Ow) ? $Ov: $Ow); if (!Ox()) { if ($lq->lw["\154\151cense_expires"] == "never") { return FALSE; } if (time()>$lq->lw["licens\145\137\145xpires"]) { return FALSE; } return TRUE; } return ($lx>time()) ? TRUE: FALSE; } else if ($la !== FALSE) { $Ov=$lq->lw["dow\156\154\157ad_access_\145\170\160ires"]; $Ow=$lq->lw["support_acces\163\137expires"]; $lx=abs(($Ov>$Ow) ? $Ov: $Ow); if (!Ox()) { if ($lq->lw["license\137\145\170pires"] == "never") { return FALSE; } if (time()>$lq->lw["license_ex\160\151\162es"]) { return FALSE; } return TRUE; } if ($lq->la >$lx) { return FALSE; } else { return TRUE; } } } function lmm_validate_license_info($release_date_info=FALSE,$license_only_info=FALSE) { $spbas_info=new Oq; if ($release_date_info !== FALSE) { $spbas_info->release_date_info =strrev(substr($release_date_info,1,012)); } $spbas_info->lr ="databas\145"; $spbas_info->ls =array("local_ke\171" => get_option("leafletmapsmarkerp\162\157\137license_l\157\143\141l_key")); $spbas_info->Os =array("\146\165\156ction" => "u\160\144\141te_option","\153ey" => "\154eafletmapsmar\153\145\162pro_licens\145\137\154ocal_key"); $spbas_info->lt ="1,2,3,4,5,6,7,8,9\054\0610"; $spbas_info->Ot =get_option("leafletmapsmark\145\162\160ro_licens\145\137\153ey"); $spbas_info->lu ="\067ca99e156b5e30\145\060648f49b81178cd\067\145"; $spbas_info->Ou ="\150\164tps://www.map\163\155\141rker.com/s\164\157\162e/api/in\144\145x.php"; $spbas_info->validate(); if ($license_only_info !== FALSE) { if ($spbas_info->lv) { return FALSE; } else { return TRUE; } } if ($spbas_info->lv) { return FALSE; } if ($release_date_info === FALSE) { $download_expires_info=$spbas_info->lw["\144ownload_access_ex\160\151\162es"]; $support_expires_info=$spbas_info->lw["\163upport_access_exp\151\162\145s"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!Ox()) { if ($spbas_info->lw["licen\163\145\137expires"] == "never") { return FALSE; } if (time()>$spbas_info->lw["\154\151cense_expires"]) { return FALSE; } return TRUE; } return ($expires_info>time()) ? TRUE: FALSE; } else if ($release_date_info !== FALSE) { $download_expires_info=$spbas_info->lw["\144\157\167nload_acces\163\137\145xpires"]; $support_expires_info=$spbas_info->lw["\163upport_access\137\145\170pires"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!Ox()) { if ($spbas_info->lw["\154\151cense_expires"] == "never") { return FALSE; } if (time()>$spbas_info->lw["\154icense_expires"]) { return FALSE; } return TRUE; } if ($spbas_info->la >$expires_info) { return FALSE; } else { return TRUE; } } } function Ox($prefix="Maps\115\141\162kerPro-") { return substr(get_option("\154eafletmapsmarkerp\162\157\137license_k\145\171"),0,strlen($prefix)) == $prefix; } function lmm_pro_version_info($prefix="MapsMa\162\153\145rPro-") { return substr(get_option("\154\145\141fletmapsmar\153\145\162pro_licen\163\145\137key"),0,strlen($prefix)) == $prefix; } function ly($prefix="\115apsMarkerPro-5P-") { return substr(get_option("\154eafletmapsmarke\162\160\162o_license_\153\145\171"),0,strlen($prefix)) == $prefix; } function Oy($prefix="\115\141psMarkerPro-25P\055") { return substr(get_option("\154\145\141fletmapsmarke\162\160\162o_licens\145\137\153ey"),0,strlen($prefix)) == $prefix; } function lz($prefix="MapsMar\153\145\162Pro-100P-") { return substr(get_option("\154eafletmapsmarker\160\162\157_license_\153\145\171"),0,strlen($prefix)) == $prefix; } function Oz($prefix="M\141\160\163MarkerPro-\062\0650P-") { return substr(get_option("lea\146\154\145tmapsmarkerp\162\157\137license_k\145\171"),0,strlen($prefix)) == $prefix; } function l10($prefix="Map\163\115\141rkerPro-500P\055") { return substr(get_option("leafletm\141\160\163markerpro_li\143\145\156se_key"),0,strlen($prefix)) == $prefix; } function O10($prefix="Map\163\115\141rkerPro-1000\120\055") { return substr(get_option("\154eafletmapsmarkerpr\157\137\154icense_ke\171"),0,strlen($prefix)) == $prefix; } function l11($attribute) { if ( isset ($_POST[$attribute]) && ($_POST[$attribute] == TRUE)) { return $_POST[$attribute]; } global $current_user; get_currentuserinfo(); switch ($attribute) { case "ma\160\163\137marker_pro_\146\151\162st_name": return $current_user->user_firstname; case "maps_m\141\162\153er_pro_last\137\156\141me": return $current_user->user_lastname; case "ma\160\163\137marker_pro_\145\155\141il": return $current_user->user_email; } return ""; } function maps_marker_pro_license_activation_page() { if ( isset ($_POST["maps_marker_p\162\157_register_free"])) { $lq=new Oq; $O11=""; $l12=array(); if (!$_POST["\155\141ps_marker_pro_fi\162\163\164_name"]) { $l12[]=__("\120lease enter you\162\040first name to\040\143ontinue.","\154mm"); } if (!$_POST["\155\141ps_marker_pro_\154\141\163t_name"]) { $l12[]=__("Please enter y\157\165\162 last na\155\145\040to cont\151\156\165e.","lmm"); } if (!$_POST["\155\141\160s_marker_p\162\157\137email"]) { $l12[]=__("Please enter you\162\040email to cont\151\156\165e.","\154mm"); } if (!$_POST["\155\141ps_marker_pro_to\163"]) { $l12[]=__("You mu\163\164\040agree to t\150\145\040TOS to \143\157\156tinue.","\154mm"); } if (empty($l12)) { $qs=array(); $qs["email"]=$_POST["\155aps_marke\162\137\160ro_emai\154"]; $qs["\146irst_name"]=$_POST["\155aps_marker_\160\162\157_first_n\141\155\145"]; $qs["la\163\164\137name"]=$_POST["\155\141\160s_marker_pro\137\154\141st_name"]; $qs["\143\157mpany_name"]= "{$_POST["maps_marker_p\162\157_first_name"]}\040{$_POST["maps_marker_pro_\154\141\163t_name"]}"; $qs["username"]=strtolower($_POST["m\141\160\163_marker_pro\137\154\141st_name"].substr($_POST["\155aps_marker_\160\162\157_first_na\155\145"],0,1)); $O12=$lq->use_curl("\150\164tps://www.m\141\160\163marker.co\155\057store/api/in\144\145x.php?mod=\063\162d_party&ta\163\153=api&api_ke\171\07550a209431\064\146bc82e712b\063\1469b21f00745",$qs); if (strtolower(substr($O12,0,5)) == "\145rror") { $l12[]=$O12; } else { $O12=json_decode($O12); update_option("\154\145afletmapsm\141\162\153erpro_lic\145\156\163e_key",$lq->Ot =$O12[0]); update_option("l\145\141\146letmapsmar\153\145\162pro_lice\156\163\145_local_k\145\171",""); update_option("\154\145afletmapsmarkerpr\157\137\154icense_k\145\171\137trial",$lq->Ot =$O12[0]); $O11=__("\131\157ur new license \167\141\163 registere\144\040successfull\171\041","lmm"); } } } else if ( isset ($_POST["maps_ma\162\153\145r_pro_regis\164\145\162_free_an\157\156\171m"])) { $lq=new Oq; $O11=""; $l12=array(); if (!$_POST["maps\137\155\141rker_pro_tos"]) { $l12[]=__("You must agr\145\145\040to the T\117\123\040to con\164\151\156ue.","lmm"); } if (empty($l12)) { $qs=array(); $O12=$lq->use_curl("\150ttps://www.mapsma\162\153\145r.com/stor\145\057api/index.p\150\160?mod=3rd_p\141\162\164y&task\075\141pi&api_key=\146\070b3782fef2\065\1433f68e809f6\062\061d193063",$qs); if (strtolower(substr($O12,0,5)) == "\145\162ror") { $l12[]=$O12; } else { $O12=json_decode($O12); update_option("\154eafletmapsmark\145\162\160ro_licens\145\137\153ey",$lq->Ot =$O12[0]); update_option("leaflet\155\141\160smarkerpro_\154\151\143ense_loc\141\154\137key",""); update_option("\154\145afletmapsmarkerp\162\157\137license_k\145\171\137trial",$lq->Ot =$O12[0]); $O11=__("\131our new licen\163\145\040was r\145\147\151stered s\165\143\143essful\154\171!","\154\155\155"); } } } else { if (!function_exists("\167\160\137verify_non\143\145")) { require_once (ABSPATH."wp-i\156\143\154udes/plugga\142\154e.php"); } $l13=( isset ($_POST["maps_marke\162\137\160ro_licens\145"]) && wp_verify_nonce($_POST["maps\137\155\141rker_pro_lic\145\156\163e"],"m\141\160\163_marker_pro_\154\151cense")); if ($l13) { update_option("\154eafletmapsma\162\153\145rpro_lice\156\163\145_local_k\145\171",""); update_option("\154eafletmapsmarker\160\162\157_license_k\145\171",$_POST["\154\145afletmapsmar\153\145\162pro_licens\145\137\153ey"]); } $lq=lm(TRUE); } include dirname( __FILE__)."/leaflet-licen\163\145\056php"; return TRUE; } class Oq { public $lv; public $Ot; public $Ou; public $O13; public $l14; public $lr; public $ls; public $Os; public $O14; public $l15; public $O15; public $lt; public $l16; public $O16; public $la; public $lw; public $l17; public $O17; function Oq() { $this->lv =FALSE; $this->O13 =0120; $this->l14 =012; $this->l18 =array("\163pbas"); $this->O18 ="spbas"; $this->lr ="\146ilesystem"; $this->lt =0; $this->l16 =0; $this->ls =FALSE; $this->Os =FALSE; $this->O14 =""; $this->l15 ="\154icense.txt"; $this->O15 ="scf"; $this->O16 =FALSE; $this->la =FALSE; $this->O17 =FALSE; $this->lw =array("custom_fie\154\144\163" => array(),"download_ac\143\145\163s_expires" => 0,"\154\151cense_expires" => 0,"lo\143\141\154_key_expires" => 0,"status" => "Invalid",); $this->l17 =array("active" => __("\124his license is \141\143\164ive.","\154\155m"),"suspended" => sprintf(__("Error: \124\150\151s license ha\163\040been suspend\145\144\056 This\040\165sually happ\145\156\163 when \163\157\155eone tr\151\145s to reg\151\163\164er a se\143\157nd trial l\151\143\145nse f\157\162\040the s\141\155\145 domai\156\056 <a href=\042\0451s\042\040\164arget=\042\137blank\042\076\120lease c\154\151ck here t\157\040get a no\156\055expiring\040\154icense fo\162\040this do\155\141in.</a>","lmm"),"\150\164tps://www.mapsm\141\162\153er.com/or\144\145\162"),"expired" => sprintf(__("Your fr\145\145\04030 day t\162\151\141l license\040\153ey has expi\162\145\144. <a hr\145\146\075\042\045\061s\042 \164\141\162get=\042\137\142lank\042\076\120lease p\165\162\143hase a \166\141lid pro li\143\145\156se key\040\164o continu\145\074/a>.","lmm"),"https\072\057/www.mapsmarker.\143\157\155/order"),"pending" => __("Error: This li\143\145\156se is pe\156\144\151ng revi\145\167\056","lmm"),"\144ownload_acces\163\137\145xpired" => __("\105\162ror: This ver\163\151\157n of the s\157\146\164ware was\040\162eleased af\164\145\162 your d\157\167\156load ac\143\145\163s exp\151\162\145d. Plea\163\145\040renew\040\171our downlo\141\144\040and s\165\160\160ort ac\143\145ss or down\147\162ade to a \160\162evious ver\163\151on.","\154mm"),"missing_l\151\143\145nse_key" => __("\120\154ease enter a\040\154\151cense ke\171\040\164o conti\156\165\145.","lmm"),"\165nknown_local\137\153\145y_type" => __("\105\162ror: An unknow\156\040\164ype of l\157\143\141l key va\154\151\144ation w\141\163\040reque\163\164\145d.","lmm"),"\143ould_not_obt\141\151\156_local_key" => __("Error: a new local\040\154\151cense key\040\143ould not be \157\142\164ained.","\154\155m"),"maximum_grace_p\145\162\151od_expire\144" => __("Error: The \155\141\170imum local\040\154icense key g\162\141\143e perio\144\040has expired\056","lmm"),"local_ke\171\137\164ampering" => __("\105\162\162or: The loca\154\040license key h\141\163\040been ta\155\160ered with or\040\151s invalid\056","\154\155\155"),"local\137\153\145y_invalid_f\157\162_location" => __("Error\072\040The local\040\154\151cense k\145\171\040is inval\151\144 for this \154\157\143ation.","lmm"),"\155\151ssing_license_f\151\154\145" => __("Error: P\154\145\141se create t\150\145\040followi\156\147\040file (\141\156\144 direct\157\162\151es if t\150\145\171 do no\164\040exist alr\145\141\144y):<br\040\057>\134r\134\156\074br />\134\162\134n","lm\155"),"\154\151cense_file_\156\157\164_writable" => __("Error: Please m\141\153\145 the follo\167\151\156g path w\162\151table:<br /\076","\154mm"),"inval\151\144\137local_key_s\164\157\162age" => __("\105\162\162or: the loc\141\154\040key sto\162\141\147e on clea\162\040could not \144\145\164ermine\144\056","\154\155\155"),"could_not_sa\166\145\137local_key" => __("\105rror: the loc\141\154\040license k\145\171\040could n\157\164\040saved\056","\154\155m"),"license_key_strin\147\137\155ismatch" => __("\105rror: The loca\154\040\153ey is inv\141\154\151d for th\151\163\040licen\163\145\056","\154\155\155"),); $this->localization =array("active" => __("\124\150is license is a\143\164\151ve.","\154\155m"),"suspended" => sprintf(__("\105\162\162or: This li\143\145\156se has b\145\145\156 suspende\144\056 This usua\154\154\171 happen\163\040when someo\156\145\040tries\040\164o register\040\141 second t\162\151\141l lice\156\163\145 for t\150\145\040same \144\157\155ain. <\141\040href=\042\045\061s\042\040\164arget=\042\137\142lank\042\076Please cl\151\143k here to\040\147et a non-\145\170piring l\151\143ense for \164\150is domai\156\056</a>","lmm"),"\150ttps://www.m\141\160\163marker.com\057\157\162der"),"expire\144" => sprintf(__("\131our free 30\040\144\141y trial \154\151\143ense key h\141\163 expired. \074\141 href=\042\045\061s\042 \164\141\162get=\042\137\142lank\042\076\120lease p\165\162\143hase a\040\166alid pro l\151\143\145nse ke\171\040to contin\165\145\074/a>.","\154\155\155"),"\150ttps://www.mapsmar\153\145\162.com/orde\162"),"p\145\156\144ing" => __("\105\162ror: This license\040\151s pending rev\151\145\167.","\154mm"),"download_acce\163\163\137expired" => __("\105\162ror: This ver\163\151\157n of the s\157\146\164ware was\040\162eleased af\164\145\162 your \144\157\167nload a\143\143\145ss exp\151\162\145d. Plea\163\145 renew you\162\040download a\156\144 support a\143\143\145ss or \144\157\167ngrade\040\164o a prev\151\157us versio\156\056","l\155\155")); } function validate() { if (!$this->Ot) { return $this->lv =$this->l17["\155\151ssing_licen\163\145\137key"]; } if (!in_array(strtolower($this->O18),$this->l18)) { return $this->lv =$this->l17["unknown_loc\141\154\137key_type"]; } $this->l19 =$this->l17["could_no\164\137\157btain_local\137\153\145y"]; switch ($this->lr) { case "\144atabase": $O19=$this->l1a(); break; case "\146\151\154esystem": $O19=$this->O1a(); break; default : return $this->lv =$this->l17["\155\151ssing_license_\153\145\171"]; } if ($this->lv == $this->l19 && $this->lt) { $l1b=$this->O1b($this->l16); if ($l1b["write"]) { if ($this->lr == "\144atabase") { $this->l1c($l1b["\154\157cal_key"]); } elseif ($this->lr == "filesystem") { $this->O1c($l1b["\154\157cal_key"],"{$this->O14}{$this->l15}"); } } if ($l1b["\145\162rors"]) { return $this->lv =$l1b["errors"]; } $this->lv =FALSE; return $this; } if ($this->lv) { return $this->lv; } return $this->l1d($O19); } function O1d($l1e,$l1b) { return ( (int) $l1e+( (int) $l1b*0250600)); } function O1b($O19) { $O1e=$this->l1f($O19); $O1f=$this->l1g($O1e); $lw=unserialize($O1f[0]); $l1e= (int) $lw["\154\157cal_key_expi\162\145\163"]; unset ($O1f,$lw); $O1g=FALSE; $O1f=explode("

",$O19); $O19=$O1f[0]; foreach ($lt=explode(",",$this->lt) as $l1h => $l1b) { if (!$l1h) { $O19.="
"; } if ($this->O1d($l1e,$l1b)>time()) { continue; } $O19.= "
{$l1b}"; $O1g=TRUE; } if (time()>$this->O1d($l1e,array_pop($lt))) { return array("\167rite" => FALSE,"\154\157cal_key" => "","\145\162\162ors" => $this->l17["\155\141ximum_grace_per\151\157\144_expired"]); } return array("\167rite" => $O1g,"\154\157cal_key" => $O19,"\145rrors" => FALSE); } function O1h($O19,$l1e) { $l1b=$this->l1g($O19,"

"); if (! isset ($l1b[1])) { return -1; } return (int) ($this->O1d($l1e,array_pop(explode("
",$l1b[1])))-time()); } function l1f($O19) { return base64_decode(str_replace("
","",urldecode($O19))); } function l1g($O19,$l1i="\173\163pbas}") { return explode($l1i,$O19); } function O1i($l1h,$l1j) { return in_array($l1h,(array) $l1j); } function wildcard_ip($l1h) { $octets=explode("\056",$l1h); array_pop($octets); $ip_range[]=implode(".",$octets).".*"; array_pop($octets); $ip_range[]=implode(".",$octets)."\056*"; array_pop($octets); $ip_range[]=implode(".",$octets)."\056*"; return $ip_range; } function wildcard_domain($l1h) { return "*.".str_replace("\167\167\167.","",$l1h); } function wildcard_server_hostname($l1h) { $hostname=explode("\056",$l1h); unset ($hostname[0]); $hostname=(! isset ($hostname[1])) ? array($l1h): $hostname; return "\052.".implode(".",$hostname); } function extract_access_set($instances,$enforce) { foreach ($instances as $l1h => $instance) { if ($l1h != $enforce) { continue; } return $instance; } return array(); } function l1d($O19) { $O1e=$this->l1f($O19); $O1f=$this->l1g($O1e); if (! isset ($O1f[1])) { return $this->lv =$this->l17["lo\143\141\154_key_tamp\145\162\151ng"]; } if (md5($this->lu.$O1f[0]) != $O1f[1]) { return $this->lv =$this->l17["local_ke\171\137\164ampering"]; } unset ($this->lu); $lw=unserialize($O1f[0]); $instance=$lw["\151\156\163tance"]; unset ($lw["\151nstance"]); $enforce=$lw["enforc\145"]; unset ($lw["\145nforce"]); $this->lw =$lw; if ( (string) $lw["licens\145\137\153ey_string"] != (string) $this->Ot) { return $this->lv =$this->l17["license_key_s\164\162\151ng_mismat\143\150"]; } if ( (string) $lw["\163\164atus"] != "\141\143tive") { return $this->lv =$this->l17[$lw["s\164\141\164us"]]; } if ( (string) $lw["license_expires"] != "never" && (int) $lw["\154\151\143ense_expi\162\145\163"]<time()) { return $this->lv =$this->l17["expired"]; } if ( (string) $lw["\154ocal_key_expire\163"] != "n\145\166\145r" && (int) $lw["loca\154\137\153ey_expires"]<time()) { if ($this->O1h($O19,$lw["local_key_expires"])<0) { $this->O1j(TRUE); return $this->validate(); } } if ($this->O16 && (int) $lw["do\167\156\154oad_access_e\170\160\151res"]<strtotime($this->la)) { return $this->lv =$this->l17["download_access_ex\160\151\162ed"]; } $conflicts=array(); $l1k=$this->O1k(); foreach ( (array) $enforce as $l1h) { $l1j=$this->extract_access_set($instance,$l1h); if (!$this->O1i($l1k[$l1h],$l1j)) { $conflicts[$l1h]=TRUE; if (in_array($l1h,array("i\160","\163\145rver_ip"))) { foreach ($this->wildcard_ip($l1k[$l1h]) as $ip) { if ($this->O1i($ip,$l1j)) { unset ($conflicts[$l1h]); break; } } } elseif (in_array($l1h,array("\144omain"))) { if ($this->O1i($this->wildcard_domain($l1k[$l1h]),$l1j)) { unset ($conflicts[$l1h]); } } elseif (in_array($l1h,array("server_hostn\141\155\145"))) { if ($this->O1i($this->wildcard_server_hostname($l1k[$l1h]),$l1j)) { unset ($conflicts[$l1h]); } } } } if (!empty($conflicts)) { return $this->lv =$this->l17["local_key_invalid\137\146or_location"]; } } function l1a() { $le=array(); if (is_array($this->ls)) { $le=$this->ls; } else { $query=@mysql_query($this->ls); if ($mysql_error=mysql_error()) { return $this->lv = "Error: {$mysql_error}"; } $le=@mysql_fetch_assoc($query); if ($mysql_error=mysql_error()) { return $this->lv = "E\162\162or: {$mysql_error}"; } } if (!$le["local_key"]) { $le["\154ocal_key"]=$this->l1l(); if ($this->lv) { return $this->lv; } $this->l1c($le["local\137\153\145y"]); } return $this->l16 =$le["\154ocal_key"]; } function l1c($O19) { if (is_array($this->Os)) { $O1l=$this->Os["\146\165\156ction"]; return $O1l($this->Os["key"],$O19); }@mysql_query(str_replace("\173\154\157cal_key}",$O19,$this->Os)); if ($mysql_error=mysql_error()) { return $this->lv = "\105\162\162or: {$mysql_error}"; } return TRUE; } function O1a() { if (!file_exists($path= "{$this->O14}{$this->l15}")) { return $this->lv =$this->l17["\155\151ssing_lic\145\156\163e_file"].$path; } if (!is_writable($path)) { return $this->lv =$this->l17["\154icense_file_\156\157\164_writabl\145"].$path; } if (!$O19=@file_get_contents($path)) { $O19=$this->l1l(); if ($this->lv) { return $this->lv; } $this->O1c(urldecode($O19),$path); } return $this->l16 =$O19; } function O1j($clear=FALSE) { switch (strtolower($this->lr)) { case "\144\141tabase": $this->l1c(""); break; case "filesystem": $this->O1c("","{$this->O14}{$this->l15}"); break; default : return $this->lv =$this->l17["\151nvalid_local_\153\145\171_storage"]; } } function O1c($O19,$path) { $fp=@fopen($path,"\167"); if (!$fp) { return $this->lv =$this->l17["could_not\137\163\141ve_local_\153\145y"]; }@fwrite($fp,$O19); @fclose($fp); return TRUE; } function l1l() { $querystring= "mod=li\143\145\156se&task=\123\120\102AS_valid\141\164\145_licens\145\046license_k\145\171\075{$this->Ot}\046"; $querystring.=$this->build_querystring($this->O1k()); if ($this->lv) { return FALSE; } $priority=$this->O15; while (strlen($priority)) { $use=substr($priority,0,1); if ($use == "s") { if ($le=$this->use_fsockopen($this->Ou ,$querystring)) { break; } } if ($use == "\143") { if ($le=$this->use_curl($this->Ou ,$querystring)) { break; } } if ($use == "\146") { if ($le=$this->use_fopen($this->Ou ,$querystring)) { break; } } $priority=substr($priority,1); } if (!$le) { $this->lv =$this->l17["\143ould_not_obtai\156\137\154ocal_ke\171"]; return FALSE; } if (substr($le,0,7) == "\111\156valid") { $this->lv =str_replace("Invalid","\105\162ror",$le); return FALSE; } if (substr($le,0,5) == "\105rror") { $this->lv =$le; return FALSE; } return $le; } function build_querystring($array) { $buffer=""; foreach ( (array) $array as $l1h => $value) { if ($buffer) { $buffer.="\046"; } $buffer.= "{$l1h}\075{$value}"; } return $buffer; } function O1k() { $l1k=array(); $l1k["domain"]=""; $l1k["ip"]=""; $l1k["\144irectory"]=""; $l1k["server_hostname"]=""; $l1k["server_\151\160"]=""; $l1k["\166\141lid_for_pro\144\165\143t_tiers"]=""; if (!extension_loaded("\163uhosin") || !defined( "SUHOSIN_PATCH")) { if (function_exists("\160\150pinfo")) { ob_start(); phpinfo(INFO_GENERAL); phpinfo(INFO_ENVIRONMENT); $phpinfo=ob_get_contents(); ob_end_clean(); $list=strip_tags($phpinfo); $l1k["\144omain"]=$this->scrape_phpinfo($list,"\110TTP_HOST"); $l1k["ip"]=$this->scrape_phpinfo($list,"\123\105\122VER_ADDR"); $l1k["\144\151rectory"]=$this->scrape_phpinfo($list,"\123CRIPT_FILENAME"); $l1k["server_hostname"]=$this->scrape_phpinfo($list,"System"); $l1k["server_ip"]=@gethostbyname($l1k["ser\166\145\162_hostname"]); } } $l1k["d\157\155\141in"]=($l1k["domain"]) ? $l1k["domain"]: $_SERVER["\110TTP_HOST"]; $l1k["ip"]=($l1k["\151\160"]) ? $l1k["ip"]: $this->server_addr(); $l1k["\144irectory"]=($l1k["director\171"]) ? $l1k["directory"]: $this->path_translated(); $l1k["\163erver_hostname"]=($l1k["\163\145rver_hostna\155\145"]) ? $l1k["\163erver_hostnam\145"]: @gethostbyaddr($l1k["ip"]); $l1k["\163\145\162ver_hostnam\145"]=($l1k["server_hostname"]) ? $l1k["server_hostname"]: "Unknown"; $l1k["\163\145\162ver_ip"]=($l1k["serve\162\137\151p"]) ? $l1k["\163erver_ip"]: @gethostbyaddr($l1k["\151p"]); $l1k["\163erver_ip"]=($l1k["server_ip"]) ? $l1k["serv\145\162\137ip"]: "Unkn\157\167\156"; foreach ($l1k as $l1h => $value) { if ($l1h == "valid_for_pr\157\144uct_tiers") { continue; } $l1k[$l1h]=($l1k[$l1h]) ? $l1k[$l1h]: "U\156\153\156own"; } if ($this->O17) { $l1k["valid\137\146\157r_product_ti\145\162s"]=$this->O17; } return $l1k; } function path_translated() { $option=array("PATH_TRANSLAT\105\104","|\174\111\107_PATH_TRANS\114\101\124ED","\123\103RIPT_FILENAM\105","\104OCUMENT_ROOT","APPL_P\110\131\123ICAL_PATH"); foreach ($option as $l1h) { if (! isset ($_SERVER[$l1h]) || strlen(trim($_SERVER[$l1h]))<=0) { continue; } if ($this->is_windows() && strpos($_SERVER[$l1h],"\134")) { return @substr($_SERVER[$l1h],0,@strrpos($_SERVER[$l1h],"\134")); } return @substr($_SERVER[$l1h],0,@strrpos($_SERVER[$l1h],"/")); } return FALSE; } function server_addr() { $options=array("\123\105RVER_ADDR","\114\117CAL_ADDR"); foreach ($options as $l1h) { if ( isset ($_SERVER[$l1h])) { return $_SERVER[$l1h]; } } return FALSE; } function scrape_phpinfo($all,$target) { $all=explode($target,$all); if (count($all)<2) { return FALSE; } $all=explode("
",$all[1]); $all=trim($all[0]); if ($target == "System") { $all=explode("\040",$all); $all=trim($all[(strtolower($all[0]) == "windows" && strtolower($all[1]) == "nt") ? 2: 1]); } if ($target == "\123\103RIPT_FILENAME") { $slash=($this->is_windows() ? "\134": "/"); $all=explode($slash,$all); array_pop($all); $all=implode($slash,$all); } if (substr($all,1,1) == "\135") { return FALSE; } return $all; } function use_fsockopen($url,$querystring) { if (!function_exists("\146\163ockopen")) { return FALSE; } $url=parse_url($url); $fp=@fsockopen($url["\150\157st"],$this->O13 ,$errno,$errstr,$this->l14); if (!$fp) { return FALSE; } $header= "PO\123\124\040{$url["\160\141th"]}\040HTTP/1.0\015
"; $header.= "Host:\040{$url["\150\157\163t"]}\015
"; $header.="Content-type: app\154\151\143ation/x-\167\167\167-form-ur\154\145ncoded\015
"; $header.="User-Agent: SPBAS \050\150ttp://www.sp\142\141\163.com)\015
"; $header.="Conten\164\055\154ength: ".@strlen($querystring)."\015
"; $header.="\103onnection: close\015
\015
"; $header.=$querystring; $le=FALSE; fputs($fp,$header); while (!feof($fp)) { $le.=fgets($fp,02000); } fclose($fp); if (strpos($le,"2\060\060") === FALSE) { return FALSE; } $le=explode("\015
\015
",$le,2); if (!$le[1]) { return FALSE; } return $le[1]; } function use_curl($url,$querystring) { if (!function_exists("curl_init")) { return FALSE; } $curl=curl_init(); $header[0]="\101ccept: text/\170\155\154,applicat\151\157\156/xml,app\154\151cation/xhtm\154\053xml,"; $header[0].="\164\145\170t/html;q=0.9\054\164ext/plain;q=\060\0568,image/pn\147\054*/*;q=0.5"; $header[]="\103\141che-Control: ma\170\055age=0"; $header[]="Connection: k\145\145\160-alive"; $header[]="Keep-Al\151\166\145: 300"; $header[]="\101\143cept-Charset:\040\111\123O-8859-1\054\165tf-8;q=0.7,*\073\161=0.7"; $header[]="Accept-Language: e\156\055us,en;q=0.5"; $header[]="Pragma:\040"; curl_setopt($curl,CURLOPT_URL,$url); curl_setopt($curl,CURLOPT_USERAGENT,"\123\120\102AS (http:/\057\167\167w.spbas.c\157\155\051"); curl_setopt($curl,CURLOPT_HTTPHEADER,$header); curl_setopt($curl,CURLOPT_ENCODING,"\147zip,deflate"); curl_setopt($curl,CURLOPT_AUTOREFERER,TRUE); curl_setopt($curl,CURLOPT_RETURNTRANSFER,1); curl_setopt($curl,CURLOPT_POSTFIELDS,$querystring); curl_setopt($curl,CURLOPT_SSL_VERIFYPEER,0); curl_setopt($curl,CURLOPT_SSL_VERIFYHOST,0); curl_setopt($curl,CURLOPT_CONNECTTIMEOUT,$this->l14); curl_setopt($curl,CURLOPT_TIMEOUT,$this->l14); $le=curl_exec($curl); $info=curl_getinfo($curl); curl_close($curl); if ( (int) $info["\150ttp_code"] != 0310) { return FALSE; } return $le; } function use_fopen($url,$querystring) { if (!function_exists("\146ile_get_c\157\156\164ents")) { return FALSE; } return @file_get_contents( "{$url}\077{$querystring}"); } function is_windows() { $l1m=explode(",",ini_get("disable_fu\156\143\164ions")); foreach ($l1m as $O1m) { $l1n[]=trim($O1m); } if (!in_array("\160\150p_uname",$l1n)) { return (strtolower(substr(php_uname(),0,7)) == "\167\151ndows"); } else { return (stristr( PHP_OS ,"\127IN")); } } function pr($stack,$O1n=TRUE) { $formatted="<pre>".var_export( (array) $stack,1)."</pre>"; if ($O1n) { exit ($formatted); } return $formatted; } } $l1o=new l4(); if (is_admin()) { if (O9()) { if (extension_loaded("ionCube Load\145\162")) { if (function_exists("\151oncube_loader_i\166\145\162sion")) { $O1o=ioncube_loader_iversion(); $l1p= (int) substr($O1o,0,1); } else { $O1p=ioncube_loader_version(); $l1p= (int) substr($O1p,0,1); } if ($l1p>=4) { $l1q="\150ttp://www.map\163\155\141rker.com/u\160\144\141tes/?ac\164\151on=get_meta\144\141\164a&slug=\154\145\141flet-ma\160\163\055mark\145\162\055pro"; } else { $l1q="http://www.maps\155\141\162ker.com/\165\160\144ates-pro/\077\141ction=get_\155\145\164adata&s\154\165\147=leafl\145\164\055maps-m\141\162ker-pro"; } } else { $l1q="http://www\056\155apsmarker.com/\165\160\144ates-pro/\077\141\143tion=g\145\164_metadata&s\154\165\147=leafle\164\055maps-marker\055\160ro"; } $O4=get_option("leafletmapsmark\145\162\137options"); if (( isset ($O4["misc_be\164\141\164est"])) && ($O4["misc_betatest"] == "\145nabled")) { $l1q=$l1q."\055beta"; } $O1q=new pluginupdatechecker($l1q,"\154\145aflet-maps-marke\162\055pro/leaflet-m\141\160s-marker.php","\154\145\141flet-maps-ma\162\153\145r-pro","\0612","\154\145afletmapsmarkerp\162\157\137pluginupd\141\164\145checker"); } } require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143\154\141ss-leaflet-\162\145\143ent-marke\162\055widget.php"); unset ($l1o); unset ($O1q); ?>